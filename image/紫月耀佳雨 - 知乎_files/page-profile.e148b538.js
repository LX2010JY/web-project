(function(z){
var ZR=function(a,b){a.hy=b};var $R=function(a,b,c,d,f){this.Xd=a=new z.Ls(a,!f);c=new z.Qs(c);d=new z.Ds(null,null,!!d,300);z.ps.call(this,a,c,d);d.Z=this;d.ol(b);(d=b.getAttribute("placeholder"))&&new z.tk(b,d)};var aS=function(a,b,c,d){var f=null;d&&(c&&(c=window.$.proxy(c,d)),f&&(f=window.$.proxy(f,d)));window.$.get("/node/"+a,{params:b},function(a){a&&a.r?f&&f(a):c&&c(a)})};var bS=function(a){z.Q.apply(this,arguments)};var cS=function(){z.G.call(this);this.kL={}};
var dS=function(a){z.Q.call(this);this.zV=a};var eS=function(a){return z.bo(a.Ee,function(a){return!!a.value})};var fS=function(a){z.Ct.call(this);this.Te="例如：互联网、医学、法律、数学...";this.data=a||[]};
var gS=function(a){if(a.hg)(0,window.$)(a.hg).on("click",".del",window.$.proxy(function(a){var c=(0,window.$)(a.target).parents(".item");c.data("active")?(z.ef(this.zn,c[0],0),z.Cr(c[0])):z.O(c[0]);z.A(this.data,function(a,b){a+""===c.data("url-token")+""&&this.data.splice(b,1)},this);this.Al();this.dispatchEvent("remove")},a))};
var hS=function(a){if(a.zn)(0,window.$)(a.zn).on("click",".add",window.$.proxy(function(a){a=(0,window.$)(a.target).parents(".item");z.ef(this.hg,a[0],0);z.Cr(a[0]);this.Al();this.dispatchEvent("add")},a))};var iS=function(){z.Q.call(this)};var jS=function(){z.G.call(this);this.vh="zm-item";this.IW=!0};var kS=function(a,b){a.o().g(b,"next",a.refresh)};var lS=function(a){z.Q.apply(this,arguments)};var mS=function(){this.Jj="editing";z.Q.call(this)};
var nS=function(a,b,c){z.sm.mb&&null==window.navigator.userAgent.match(/iPad/i)||(a=(0,window.$)(".item",a.O).index(b),b.siblings().eq(a-a%2).height(c?"auto":b.height()))};var oS=function(a){z.Q.apply(this,arguments)};var pS=function(a){return window.$.post("/people/edit",{data:JSON.stringify(a)})};
var qS=function(a){var b=(0,window.$)(".js-genderItem",a.h);a.jD=(0,window.$)('[name\x3d"gender"]',b);rS(b,function(){var b=a.jD.filter(":checked").val();if(b)return pS({gender:b}).then(function(a){a&&!a.r&&(a.value="1"===b?"男":"女");return a});z.V.alert("请选择你的性别")})};
var sS=function(a){var b=(0,window.$)(".js-weiboItem",a.h);a.LM=(0,window.$)('[name\x3d"weibo-visi"]',b);rS(b,function(){var b=a.LM.filter(":checked").val();return pS({enable_weibo:b}).then(function(a){a&&!a.r&&(a.value="1"===b?"是":"否");return a})})};var tS=function(a){var b=(0,window.$)(".js-headlineItem",a.h);a.kD=(0,window.$)('[name\x3d"headline"]',b);rS(b,function(){var b=a.kD.val();return pS({headline:b}).then(function(a){a&&!a.r&&(a.value=b);return a})})};
var uS=function(a){var b=(0,window.$)(".js-descriptionItem",a.h);a.fD=(0,window.$)('[name\x3d"description"]',b);rS(b,function(){var b=a.fD.val();return pS({description:b}).then(function(a){a&&!a.r&&(a.value=b);return a})})};
var vS=function(a){var b=(0,window.$)(".js-orgHomepageItem",a.h);a.BM=(0,window.$)('[name\x3d"orgHomepage"]',b);rS(b,function(){var b=a.BM.val().trim();b&&!z.Ia(b,"http")&&(b="http://"+b);return pS({org_homepage:b}).then(function(a){a&&!a.r&&(a.value='\x3ca href\x3d"'+b+'" target\x3d"_blank"\x3e'+b+"\x3c/a\x3e");return a})})};
var wS=function(a){var b=(0,window.$)(".js-businessItem",a.h);a.bD=(0,window.$)('[name\x3d"business"]',b);rS(b,function(){var b=a.bD.val();return pS({business:b}).then(function(a){a&&!a.r&&(a.value=b);return a})})};var xS=function(a){var b=(0,window.$)(".js-expertItem",a.h);a.hD=(0,window.$)('[name\x3d"enable_expert"]',b);rS(b,function(){var b=a.hD.filter(":checked").val();return pS({enable_expert:b}).then(function(a){a&&!a.r&&(a.value="1"===b?"开启":"关闭");return a})})};
var rS=function(a,b){function c(){d.toggle();f.toggle()}var d=(0,window.$)(".ProfileEditCard-staticContent",a),f=(0,window.$)(".ProfileEditCard-editableContent",a),g=(0,window.$)(".js-toggleContent",a),h=(0,window.$)(".js-save",a),k=(0,window.$)(".js-value",a);g.click(c);h.click(z.sk(h,function(){return b().then(function(b){if(b)if(b.r){var d=b.msg;z.Y.hd&&263===b.errcode&&z.ma(d)&&(d[0][1]={headline:"Slogan 不能超过 40 个字",description:"机构简介不能超过 500 个字"}[d[0][0]]);z.V.message(z.ma(d)?d[0][1]:d)}else c(),
k.html(b.value),a.toggleClass("is-empty",!b.value)})}))};var yS=function(a){var b=(0,window.$)(".js-locationTagEditor",a.h)[0];if(b){var c=a.vT=new dS;c.w(b);zS(a,c,function(){var a=(0,window.$)(".ProfileTagEditor-item",b).map(function(a,b){return(0,window.$)(b).data("title")}).get();return pS({location:a})})}};var AS=function(a){var b=(0,window.$)(".js-employmentTagEditor",a.h)[0];if(b){var c=a.OP=new dS;c.w(b);zS(a,c,function(){var c=(0,window.$)(".ProfileTagEditor-item",b).map(a.PJ).get();return pS({employment:c})})}};
var BS=function(a){var b=(0,window.$)(".js-educationTagEditor",a.h)[0];if(b){var c=a.MP=new dS;c.w(b);zS(a,c,function(){var c=(0,window.$)(".ProfileTagEditor-item",b).map(a.PJ).get();return pS({education:c})})}};
var zS=function(a,b,c){var d=b.m(),f=(0,window.$)(".ProfileEditCard-staticContent",d),g=(0,window.$)(".ProfileEditCard-editableContent",d);(0,window.$)(".js-toggleContent",d).click(function(){f.toggle();g.toggle()});a.o().g(b,["remove","dragend"],c).g(b,"add",function(){f.toggle();g.toggle();return c()})};
var CS=function(a){var b=(0,window.$)(".ProfileProgress");if(b.length){var c=new cS,d=(0,window.$)(".ProfileProgress-completeness",b);a.o().g(c,"update",function(){var a=(0,window.parseInt)(100*c.Y(),10);10>a&&(a=10);a+="%";d.width(a).text(a)});[a.vT,a.OP,a.MP].forEach(function(a,b){c.watch({name:"tagEditor"+b,target:a,ij:["add","remove"],Ue:function(){return!!a.Xa.children().length}})});var f=a.jD,g=a.kD,h=a.fD,k=a.bD,l=a.hD;c.watch({name:"expert",target:l[0],ij:["change"],Ue:function(){return l.filter(":checked").length}}).watch({name:"expert",
target:l[1],ij:["change"],Ue:function(){return l.filter(":checked").length}}).watch({name:"gender",target:f[0],ij:["change"],Ue:function(){return f.filter(":checked").length}}).watch({name:"gender",target:f[1],ij:["change"],Ue:function(){return f.filter(":checked").length}}).watch({name:"description",target:h[0],ij:["blur"],Ue:function(){return!!h.val().trim()}}).watch({name:"business",target:k[0],ij:["blur"],Ue:function(){return!!k.val().trim()}}).watch({name:"headline",target:g[0],ij:["blur"],Ue:function(){return!!g.val().trim()}})}};
var DS=function(){z.Q.call(this)};var ES=function(a){var b=z.J("zh-profile-ask-list");if(b){var c=new z.Cl({use:["autoload","locationSource"],Rf:!1});a.L(c);c.w(b);if(a=z.L("zm-profile-section-list"))b=new jS,b.cj("zm-profile-section-item"),kS(b,c),b.init(a)}};
var FS=function(a){var b=(0,window.$)("#zh-profile-log-list").get(0);if(b){var c=new z.Cl;c.use("locationSource",{dB:!0});a.L(c);c.w(b);z.mE(b);(0,window.$)(b).on("click",'a[name\x3d"report"]',function(a){z.X.trackEvent(a.currentTarget,{action:"Report",element:"Button"});(new z.SB({type:"activity",id:(0,window.$)(a.currentTarget).data("id")})).submit()});z.bl(c,function(a){return z.X.xb(a,{module:"LogItem"},function(){return{card:{card_type:"Content",content:{type:"Log",id:(0,window.$)(a).attr("id").replace(/logitem-/,
"")}}}})})}};var GS=function(a){var b=(0,window.$)("#zh-profile-fav-list \x3e .zh-general-list").get(0);if(b){var c=new z.Cl({use:["autoload","nodeSource"],Rf:!1});a.L(c);c.w(b)}(0,window.$)("#zh-profile-fav-list").on("click",".zm-profile-fav-edit",function(){z.zi({category:"collection",action:"popup_edit_collection_appear",label:"people_profile_collections_edit_collection"})})};
var HS=function(a){var b=z.J("zh-profile-topic-list");if(b){var c=new z.Cl({use:["autoload","locationSource"]});a.L(c);a.o().g(c,"itemcreated",function(a){a=a.item;var b=a.getAttribute("data-tid").split("-")[1];if(z.Y.xg===z.nh[3]){var c=new z.Uv(!0,"/topic/bio/update","bio");c.RC=!0;c.params=["tid\x3d"+b];c.cc='\x3ca href\x3d"javascript:;" name\x3d"edit"\x3e添加你在该话题的经验\x3c/a\x3e';c.w(a)}});c.w(b);if(a=z.L("zm-profile-section-list"))b=new jS,b.cj("zm-profile-section-item"),kS(b,c),b.init(a)}};
var IS=function(a){var b=(0,window.$)("#zh-profile-column-list \x3e .zh-general-list").get(0);if(b){var c=new z.Cl({use:["autoload","nodeSource"]});a.L(c);c.w(b)}};var JS=function(a){var b=(0,window.$)("#zh-profile-follows-list \x3e .zh-general-list").get(0);if(b){var c=new z.Cl({use:["autoload","nodeSource"]});a.L(c);c.w(b)}};var KS=function(a){var b=(0,window.$)("#zh-profile-follows-list-old").get(0);if(b){var c=new z.Cl({use:["autoload","locationSource"]});a.L(c);c.w(b)}};
var LS=function(a){var b=(0,window.$)("#zh-profile-answer-list \x3e .zh-general-list").get(0)||(0,window.$)("#zh-profile-answer-list").get(0);if(b){var c=new z.Cl({Rf:!1});a.L(c);c.use("childConstructor",{Ej:z.ED}).use("expandLimit");c.w(b);a.o().g(c,"click!",function(a){"comment"===a.namespace&&a.Ic.fill("category","profile").fill("label","profile_answers_list")});if(a=z.L("zm-profile-section-list"))b=new jS,kS(b,c),b.init(a)}};
var MS=function(a){var b=z.J("zh-profile-page-force-to-rename");(a.yy=b)&&a.o().g(b,"click",a.TX)};var NS=function(a){var b=z.J("zh-profile-activity-wrap");b&&a.o().g(b,"click",function(a){if((a=a.target)&&"focus"===a.name){var b=a.getAttribute("data-type");(0,z.LG)(a,b,null,["zm-profile-follow-link-gray","zm-profile-unfollow-link-gray"])}})};
var OS=function(a){var b=z.J("zh-profile-activity-page-list");if(b){var c=new z.Cl({use:["expandLimit"],Rf:!0});c.use("locationSource",{url:"/people/"+z.nh[1]+"/activities",Tt:10,param:function(a){return{start:z.jb(a).getAttribute("data-time")}}});c.use("childConstructor",{factory:z.UD});a.L(c);c.w(b);a.o().g(c,"click!",function(a){"comment"===a.namespace&&a.Ic.fill("category","profile").fill("label","profile_feed")})}};
var PS=function(){var a=z.L("zm-profile-header-operation");a&&(new z.RF).w(a);if(a=z.L("zm-profile-header"))(new lS).w(a),(0,window.$)(".zm-profile-header .icon-badge-wrapper").on("click",function(){(0,window.$)(".zm-profile-side-badges-section").each(function(a,c){return z.Cr(c)})})};
var QS=function(a){var b=z.L("zm-profile-answer-sort");b&&(a.hi=new z.Qz,a.hi.Ha(a.$N=new z.Lz("按时间排序")),a.hi.Ha(a.aO=new z.Lz("按投票排序")),a.hi.Ha(a.ZN=new z.Lz("问"+z.Y[0]+"的问题")),a.hi.render(b),a.hi.G(!1),a.o().g(b,"click",function(a){this.hi.G(!0);a.stopPropagation();this.o().ya(window.document,"click",function(){this.hi.G(!1)})}),a.o().g(a.hi,"action",a.JR))};
var RS=function(a,b){var c=new z.tp(!0);a.o().ya(c,"complete",function(){window.location.reload()});c.ajax("/people/"+z.nh[1]+"/block","action\x3d"+(b?"add":"cancel"))};var SS=function(){var a=(0,window.$)(".ProfileEditCard")[0];a&&(new oS).w(a)};var TS=function(a){var b=z.L("zm-profile-fav-wrap");b&&a.o().g(b,"click",a.UP)};
var US=function(a){var b=(0,window.$)(".zm-profile-section-wrap.column-list");b.length&&((0,window.$)(".js-expand",b).click(function(){(0,window.$)(".zm-profile-section-list",b).append((0,window.$)(".ProfileColumnItem-template").html());(0,window.$)(this).hide();return!1}),b.on("click",".item",function(a){"a"!==a.target.tagName.toLowerCase()&&window.open((0,window.$)(this).data("href"))}));var c=(0,window.$)("#zh-profile-post-list").get(0);if(c){var d=new z.Cl({Rf:!1});a.L(d);d.use("childConstructor",
{Ej:z.MD}).use("expandLimit");d.w(c);a.o().g(d,"click!",function(a){"comment"===a.namespace&&a.Ic.fill("category","profile").fill("label","profile_posts_list")})}};var VS=function(){var a=z.J("zh-profile-edit-expert");a&&(new iS).w(a)};
var WS=function(a){var b=z.L("profile-expert-tip");b&&a.o().g(b,"click",function(a){var c=a.target;"enable"!==c.name&&"close"!==c.name||window.$.post("/node/ProfileExpertTopicsV2",{method:c.name},function(a){a&&a.r||("enable"===c.name?window.location.href="/people/edit/expert":z.vr(b,!0))})});var c=(0,window.$)(".zm-profile-section-wrap.skilled-topics");c.length&&((new mS).w(c[0]),(0,window.$)(".js-expand",c).click(function(){(0,window.$)(".zm-profile-section-list",c).append((0,window.$)(".ProfileExpertItem-template").html());
(0,window.$)(this).hide();return!1}));(0,window.$)(".zm-profile-module.skilled-topics").each(function(){(new mS).w(this)});(0,window.$)(".zm-profile-module.active-topics").each(function(){(new mS).w(this)})};var XS=function(){var a=(0,window.$)(".js-ProfileBan-timer");if(a.length)var b=Number(a.html()),c=(0,window.setInterval)(function(){b--;a.html(b);0===b&&((0,window.clearInterval)(c),window.location.href="/")},1E3)};
var YS=function(){"#hilightbadge"===window.location.hash&&(0,window.$)(".zm-profile-side-badges-section").each(function(a,b){return z.Cr(b)})};z.y($R,z.Zs);$R.prototype.Pm=function(a,b){a=a[0].slice(1);a=z.lb(a,function(a){return 3<a.length});a=z.mb(a,function(a){return a[1]});this.filter&&(a=this.filter(a));$R.v.Pm.call(this,a,b)};z.n(bS,z.Q);
bS.prototype.T=function(a){z.Q.prototype.T.call(this);this.O=(0,window.$)(a);this.De=(0,window.$)(".info-wrap",this.O);this.ge=(0,window.$)(".edit-wrap",this.O);(0,window.$)(".title",this.De);this.pj=(0,window.$)("input",this.ge)};
bS.prototype.C=function(){z.Q.prototype.C.call(this);this.O.on("click",'[name\x3d"edit"]',z.Oq(window.$.proxy(function(){this.O.addClass("editing");var a=this.ge.find("input").get(0);a?a.focus():(a=this.ge.find("textarea").get(0))&&a.focus()},this),[!0,{Ge:!1}]));var a=this;this.qr=[];(0,window.$)("input[type\x3dtext]",this.O).each(function(){var b=new $R("/topic/autocomplete",this,(0,window.$)(this).parents(".topic-input-wrap")[0]);a.qr.push(b)});this.ge.on("keydown","input",function(a){13===a.keyCode&&
(0,window.setTimeout)(function(){var b=(0,window.$)(a.target),f=b.parents(".edit-wrap").children().index(b.parent()),g=b.parents(".edit-wrap").find("input, select").get(f+1),f=b.parents(".edit-wrap").find("input, select").get(f-1);b.val()&&(g?g.focus():f&&!(0,window.$)(f).val()&&f.focus())})});this.ge.on("click",'[name\x3d"cancel"], [name\x3d"save"]',window.$.proxy(function(a){a=a.target.name;"cancel"===a?this.cancel():"save"===a&&this.save()},this));var b=(0,window.$)(".fold-wrap");b.click(function(a){"fold"===
a.target.name?b.addClass("fold"):"unfold"===a.target.name&&b.removeClass("fold")})};
bS.prototype.save=function(){var a=this,b=this.O.data("name");if("location"===b){var b=this.ge.find("input.location"),c=this.ge.find("select"),d=this.ge.find("input.male").is(":checked")?1:0;window.$.post("/node/ProfileHeaderV2",{method:"save",params:{data:{location:[b.val()],business:c.val(),gender:d}}},function(b){b&&b.r?z.V.message(b.msg):(b=b.msg,b.location[0].html||(b.location[0].html='\x3ca href\x3d"javascript:;" class\x3d"zg-link-litblue-normal" name\x3d"edit"\x3e填写居住地\x3c/a\x3e'),b.business.html||
(b.business.html='\x3ca href\x3d"javascript:;" class\x3d"zg-link-litblue-normal" name\x3d"edit"\x3e填写行业\x3c/a\x3e'),a.De.find("span.location").attr("title",b.location[0].text).html(b.location[0].html),a.De.find("span.business").attr("title",b.business.text).html(b.business.html),b=1===(0,window.parseInt)(b.gender,10)?"male":"female",a.De.find("span.gender i").removeClass("icon-profile-female icon-profile-male").addClass("icon-profile-"+b),a.cancel())})}else"employment"===b?(c=this.ge.find("input.employment"),
b=this.ge.find("input.position"),c=c.val(),b=b.val(),window.$.post("/node/ProfileHeaderV2",{method:"save",params:{data:{employment:[[c,b]]}}},function(b){b&&b.r?z.V.message(b.msg):(b=b.msg,b.employment[0][0].text||b.employment[0][1].text?a.O.removeClass("empty"):a.O.addClass("empty"),b.employment[0][0].html||(b.employment[0][0].html='\x3ca href\x3d"javascript:;" class\x3d"zg-link-litblue-normal" name\x3d"edit"\x3e填写公司信息\x3c/a\x3e'),b.employment[0][1].html||(b.employment[0][1].html='\x3ca href\x3d"javascript:;" class\x3d"zg-link-litblue-normal" name\x3d"edit"\x3e填写职位\x3c/a\x3e'),
a.De.find(".employment").attr("title",b.employment[0][0].text).html(b.employment[0][0].html),a.De.find(".position").attr("title",b.employment[0][1].text).html(b.employment[0][1].html),a.cancel())})):"education"===b?(c=[this.ge.find("input.education"),this.ge.find("input.education-extra")],b=c[0].val(),c=c[1].val(),window.$.post("/node/ProfileHeaderV2",{method:"save",params:{data:{education:[[b,c]]}}},function(b){b&&b.r?z.V.message(b.msg):(b=b.msg,b.education[0][0].text||b.education[0][1].text?a.O.removeClass("empty"):
a.O.addClass("empty"),b.education[0][0].html||(b.education[0][0].html='\x3ca href\x3d"javascript:;" class\x3d"zg-link-litblue-normal" name\x3d"edit"\x3e填写学校信息\x3c/a\x3e'),b.education[0][1].html||(b.education[0][1].html='\x3ca href\x3d"javascript:;" class\x3d"zg-link-litblue-normal" name\x3d"edit"\x3e填写专业\x3c/a\x3e'),a.De.find(".education").attr("title",b.education[0][0].text).html(b.education[0][0].html),a.De.find(".education-extra").attr("title",b.education[0][1].text).html(b.education[0][1].html),
a.cancel())})):"description"===b&&(b=this.ge.find("textarea.description"),window.$.post("/node/ProfileHeaderV2",{method:"save",params:{data:{description:b.val()}}},function(b){b&&b.r?z.V.message(b.msg):(b=b.msg,b.description.text?a.O.removeClass("empty"):(b.description.fold_html='\x3ca href\x3d"javascript:;" class\x3d"zg-link-litblue-normal" name\x3d"edit"\x3e填写个人简介\x3c/a\x3e',b.description.unfold_html='\x3ca href\x3d"javascript:;" class\x3d"zg-link-litblue-normal" name\x3d"edit"\x3e填写个人简介\x3c/a\x3e',
a.O.addClass("empty")),a.De.find(".fold-item .content").empty().html(b.description.fold_html),a.De.find(".unfold-item .content").html(b.description.unfold_html),b.description.shortened?a.De.removeClass("disable-fold"):a.De.addClass("disable-fold"),a.cancel())}))};bS.prototype.cancel=function(){this.O.removeClass("editing")};z.n(cS,z.G);cS.prototype.update=function(a,b){this.kL[a]=b;this.dispatchEvent({type:"update"})};
cS.prototype.watch=function(a){function b(){return c.update(a.name,a.Ue())}var c=this;b();z.F(a.target,a.ij,b);return this};cS.prototype.Y=function(){var a=Object.values(this.kL),b=a.filter(Boolean).length;return a.length&&b/a.length};z.y(dS,z.Q);z.e=dS.prototype;
z.e.T=function(a){dS.v.T.call(this,a);this.Ee=(0,window.$)("input",a);this.Xa=(0,window.$)(".ProfileTagEditor-list",this.h);this.qr=[];var b=this;b.qr=this.Ee.map(function(){var a=new $R("/topic/autocomplete",this,b.zV||(0,window.$)(this).closest(".js-inputWrapper")[0]);a.Gn=!1;var d=(0,z.t)(b.filter,b);a.filter=d;return a});this.Qm()};
z.e.C=function(){this.o().g(z.L("js-add",this.h),"click",this.add);var a=this;this.Ee.each(function(){a.o().g(this,"keydown",function(a){this.keydown(a)})});z.A(this.qr,function(b){a.o().g(b.M,z.rs,a.select)});this.Xa.on("click",".js-delete",window.$.proxy(this.remove,this));this.Qm()};
z.e.Qm=function(){if(!z.sm.mb){var a=this;this.le&&this.le.H();var b=new z.bt;b.Gb(this);b.us=(0,z.ab)("is-moving").split(" ");z.ct(b,this.Xa[0],0);b.init();this.le=b;(0,window.$)("a, input, button",this.Xa).each(function(){a.o().g(this,"mousedown",function(a){a.stopPropagation()})})}};z.e.keydown=function(a){13===a.keyCode&&(0,window.setTimeout)((0,z.t)(function(){eS(this)&&this.add();this.Ee[0].value&&this.Ee[1]&&!this.Ee[1].value&&this.Ee[1].focus()},this));return!0};
z.e.fq=function(){z.A(this.Ee,function(a){a.value=""});this.Ee[0].focus()};z.e.select=function(){eS(this)&&this.add()};z.e.add=function(){var a=(0,z.ab)(this.Ee[0].value),b={title:a};if(this.Ee[1]){var c=(0,z.ab)(this.Ee[1].value);if(!a&&!c)return;b.sub_title=c}aS("ProfileTagEditorItem",b,this.XT,this)};
z.e.XT=function(a){a=(0,window.$)(a);var b;if(a.data("title")){if(b=this.Xa.find("[data-title\x3d'"+a.data("title")+"']")[0]){z.Cr(b);this.fq();return}}else if(a.data("sub-title")&&(b=this.Xa.find("[data-sub-title\x3d'"+a.data("sub-title")+"']")[0])){z.Cr(b);this.fq();return}this.Xa.append(a);this.Qm();this.fq();this.dispatchEvent("add")};z.e.remove=function(a){(0,window.$)(a.target).parents("li").remove();this.dispatchEvent("remove")};
z.e.filter=function(a){return z.lb(a,function(a){return!this.Xa.find("[data-title\x3d'"+a+"']")[0]},this)};z.y(fS,z.Ct);z.e=fS.prototype;z.e.w=function(a){this.h=a;this.Lg=z.L("zm-tag-editor-labels",this.h);this.we(!0);this.je();this.ec();this.hg=z.J("zh-expert-topics");this.zn=z.J("zh-active-topics");gS(this);hS(this);this.data=(0,window.$)("#zh-expert-topics .item").map(function(){return(0,window.$)(this).data("url-token")}).get();this.Qm()};
z.e.Pl=function(){this.Bc||(this.Bc=z.M("div","zm-tag-editor-editor",[this.me=z.M("div","zg-section zm-tag-editor-command-buttons-wrap",[this.Za=z.J("profile-expert-edit-input")])]),this.Te&&(this.cA=new z.nt(this.Te),this.cA.w(this.Za),this.Za.title=this.Te),z.df(this.Bc,this.Lg),this.Df(this.me))};
z.e.Df=function(a){this.R=new z.Bt("/topic/autocomplete",this.Za,null,null,a,!0);this.R.Ig(!0);this.R.wk=this.xe;this.R.Vm(this.Of());ZR(this.R,[this.Te]);this.o().g(this.R,"select",this.Kf);this.o().g(this.R,"suggestionsupdate",this.An);this.o().g(this.R,"suggestionsupdate",this.zw);this.o().g(this.R,z.ts,function(){(0,window.$)(this.R.M.h).hide()})};z.e.zw=function(){if(0===this.R.Ma.length){var a=z.M("div",{className:"zu-autocomplete-empty"},"没有名字为 "+(0,window.$)(this.Za).val()+" 的话题");(0,window.$)(this.R.M.h).html(a).show()}};
z.e.Kf=function(){var a=this.R.og().slice(1);a&&3<a.length&&(this.qF=a,this.He(a))};z.e.He=function(a){this.data.push(a[1]);var b=(0,window.$)(this.hg).find("[data-url-token\x3d'"+a[1]+"']")[0];b?z.Cr(b):(aS("TopicMediumV2",{member_url_token:z.Y[1],topic_url_token:a[1]},this.cs,this),(0,window.$)(this.zn).find("[data-url-token\x3d'"+a[1]+"']").remove(),this.dispatchEvent("add"))};z.e.cs=function(a){a=(0,window.$)(a)[0];z.ef(this.hg,a,0);z.Cr(a);this.Al()};z.e.Hd=function(){};
z.e.Qm=function(){if(!z.sm.mb){var a=this;this.le&&this.le.H();var b=new z.bt;b.us=(0,z.ab)("expert-item-moving").split(" ");z.ct(b,this.hg,4);b.init();this.le=b;this.o().g(this.le,"dragend",function(){this.dispatchEvent("sort")});(0,window.$)("a, input, .del, .add",this.hg).each(function(){a.o().g(this,"mousedown",function(a){a.stopPropagation()})});this.o().g(this.le,"beforedragstart",function(){return z.L("editing",this.hg)?!1:!0})}};
z.e.Al=function(){var a=(0,window.$)(this.hg).children().length;20<a&&z.O((0,window.$)(this.hg).children()[20]);z.P(z.J("zh-profile-expert-empty"),0>=a);0<a&&z.P(z.J("zh-profile-expert-warning"),!1);a=(0,window.$)(this.zn).children().length;z.P(z.J("active-topics-wrap"),a);this.Qm()};z.e.Of=function(){return(0,z.t)(function(a){return z.lb(a,function(a){return z.bo(this.data,function(c){return c+""!==a[2]+""&&3<a.length})},this)},this)};z.y(iS,z.Q);
iS.prototype.T=function(a){this.h=a;this.Ka=new fS;this.Ka.w(this.h);this.form=z.J("zm-profile-expert-editform");this.o().g(this.form,"submit",this.tu);this.o().g(this.Ka,["add","remove","sort"],function(){this.hh()});(0,window.$)(".enable").on("change","input",window.$.proxy(function(){this.hh()},this));var b=z.J("zh-profile-expert-warning");b&&this.o().g(b,"click",function(a){"close"===a.target.name&&z.vr(b)});(0,window.$)(".enable input[type\x3d'radio']").click(function(a){a=!Number((0,window.$)(a.target).val());
z.P(z.J("zh-profile-expert-reopen-tip"),a)})};iS.prototype.hh=function(){(0,window.$)(window).on("beforeunload.profile",(0,z.t)(function(){return"你的更改还未保存，确认离开该页面吗？"},this))};iS.prototype.vi=function(){(0,window.$)(window).off("beforeunload.profile")};
iS.prototype.tu=function(a){a.preventDefault();z.mb(this.Ka.data,function(a){return a[3]});a=(0,window.$)(this.form).serializeArray()[0].value;var b=(0,window.$)("#zh-expert-topics .item").map(function(){return(0,window.$)(this).data("url-token")}).get(),c=this;window.$.post("/node/ProfileEditExpertTopicsV2",{method:"save",params:{settings:{enable_expert:a,expert_topic:b}}},function(a){a&&a.r||(c.vi(),window.location.href="/people/"+z.Y[1])})};z.y(jS,z.Vj);z.e=jS.prototype;
z.e.init=function(a){this.Nb=a;this.o().g(a,"click",this.Va);this.refresh()};z.e.cj=function(a){this.vh=a};
z.e.Va=function(a){if(a.target){var b=z.Jr(this.Nb,a.target);b&&(this.type=b.getAttribute("data-type"),this.id=b.getAttribute("data-id"),this.action=b.name,this.item=z.Io(a.target,this.vh),this.type&&this.id&&this.action&&this.item&&!this.qM&&(this.qM=!0,this.xhr=new z.tp(!0),this.o().g(this.xhr,"complete",this.Ek),this.xhr.ajax("/people/"+("top"===this.action?"pin":"unpin")+"_"+this.type,this.type+"_id\x3d"+this.id,"POST")))}};
z.e.Ek=function(){if("cancel-top"===this.action)z.vr(this.item,!0);else if("top"===this.action){var a=z.Ro(this.vh,this.Nb);z.Yn(this.item);a&&2<=a.length&&z.cf(z.O(this.item),z.L(this.vh,this.Nb));this.scroll();z.Cr(this.item);a=z.L("zm-item-top-btn-top",this.item);z.P(a,!1);a=z.L("zm-item-top-btn-cancel",this.item);z.P(a,!0);this.refresh()}this.qM=!1};z.e.scroll=function(){if(this.IW){var a=z.L("zm-profile-section-wrap"),b=z.xf(z.Ie((z.u||window).document)).y;a&&0>z.Yn(a).y-b&&a.scrollIntoView()}};
z.e.refresh=function(){var a=z.Ro(this.vh,this.Nb);a&&0<a.length&&z.A(a,function(a,c){if(0!==c){var d=z.L("zm-item-top-btn-top",a);d&&z.P(d,!0)}},this)};z.n(lS,z.Q);lS.prototype.T=function(a){z.Q.prototype.T.call(this);a&&(this.O=(0,window.$)(a),(a=(0,window.$)(".ProfileAvatarEditor",this.O)[0])&&(new z.Bz).w(a),(0,window.$)(".editable-group",this.O).each(function(){(new bS).w(this)}),(a=z.J("profile-header-description-input"))&&new z.Xr(a))};z.y(mS,z.Q);
mS.prototype.T=function(a){mS.v.T.call(this,a);this.O=(0,window.$)(a);this.O.on("click",'a[href^\x3d"javascript"]',window.$.proxy(this.Va,this));this.O.on("click",'a[href^\x3d"javascript"], input',!1);this.O.on("click",".item",window.$.proxy(this.lV,this))};mS.prototype.lV=function(a){var b=(0,window.$)(a.currentTarget),c=b.data("href"),b=c&&!b.hasClass(this.Jj);a=a.metaKey||a.ctrlKey;b&&(a?window.open(c):window.location.href=c)};
mS.prototype.Va=function(a){var b=(0,window.$)(a.currentTarget),c=b.closest(".item");a=b.attr("name");if("edit"===a)b.closest(".description").hide().siblings(".description-edit").show().find("input").focus().closest(".item").addClass(this.Jj).closest(".skilled-topics").addClass(this.Jj),nS(this,c);else if("cancel"===a)b.closest(".description-edit").hide().siblings(".description").show().closest(".item").removeClass(this.Jj).closest(".skilled-topics").removeClass(this.Jj),nS(this,c,!0);else if("save"===
a){var d=new z.tp(!0);this.o().g(d,"success",function(){var a=z.Tn(d);a.r?z.V.message(a.msg):(b.closest(".description-edit").hide().siblings(".description").show().children(".des").text(a.msg).siblings(".edit").addClass("zu-edit-button").children(".edit-msg").html("修改").closest(".item").removeClass(this.Jj).closest(".skilled-topics").removeClass(this.Jj),nS(this,c,!0))});d.ajax("/topic/bio/update","tid\x3d"+b.closest(".item").data("id")+"\x26bio\x3d"+b.parent().siblings("input").val(),"POST")}};
z.n(oS,z.Q);oS.prototype.C=function(){z.Q.prototype.C.call(this);var a=(0,window.$)(".ProfileAvatarEditor",this.h)[0];a&&(new z.Bz).w(a);qS(this);sS(this);tS(this);uS(this);vS(this);wS(this);yS(this);AS(this);BS(this);xS(this);CS(this)};oS.prototype.PJ=function(a,b){var c=(0,window.$)(b),d=c.data("title"),c=c.data("subTitle")||"";return[[d,c]]};z.y(DS,z.Q);z.e=DS.prototype;z.e.init=function(){z.OG.L(this);this.w(window.document.body)};
z.e.C=function(){DS.v.C.call(this);PS();YS();NS(this);MS(this);OS(this);TS(this);SS();QS(this);VS();WS(this);US(this);ES(this);LS(this);FS(this);HS(this);IS(this);JS(this);KS(this);GS(this);this.Yo();XS();-1<window.location.search.indexOf("clean-followers-noti\x3d1")&&(new z.tp(!0)).ajax("/notification/clear","no_refresh_content\x3dtrue\x26type\x3dfollow");(0,window.$)("#__signin").click(function(){(new z.Rk).show()});(0,window.$)(".zm-profile-header-user-edit").click(z.Oq(z.r,[!0,{Ge:!1}]))};
z.e.TX=function(){z.V.confirm("确定","确定要强制此用户改名吗？",function(a){if(a&&(z.J("realname_form").submit(),this.yy.innerHTML="已发送",z.U.add(this.yy,"zg-gray"),a=this.yy))if(z.Vc(a))a.oe&&a.oe.removeAll(void 0);else if(a=z.ed(a)){var b=0,c;for(c in a.pc)for(var d=a.pc[c].concat(),f=0;f<d.length;++f)z.nd(d[f])&&++b}},this)};
z.e.Yo=function(){if((0,window.$)(".zu-main-sidebar").length){this.kk();var a=z.J("zm-profile-header-pm-btn");a&&z.F(a,"click",z.hp(function(a){a.preventDefault()},z.Oq(function(){var b=new z.zx({pl:!1});b.show();z.Bx(b,z.nh[3],z.nh[0]);z.Ax(b,a.href);b.Dd.focus()},!0)));var b=z.J("zh-profile-cancel-block");b&&this.o().g(b,"click",this.hJ);b=(0,window.$)("#zh-report-people, #profile-side-op a[name\x3dreport]");b.length&&(b.on("click",function(a){(new z.SB({type:"member",id:z.nh[3]})).render();z.X.trackEvent(a.currentTarget,
{action:"ReportIntent",element:"Button"})}),z.X.xb((0,window.$)(".zu-main-sidebar")[0],{module:"RightSideBar"}),z.X.xb(b[0],{module:"UserItem"},function(){return{card:{card_type:"Content",content:{type:"User",token:z.nh[1]}}}}));(0,window.$)(".zm-profile-side-badge .more-trigger").on("click",function(a){a.preventDefault();(0,window.$)(".zm-profile-side-badge .more-trigger-wrapper").hide();(0,window.$)(".zm-profile-side-badge .more-topics").removeAttr("hidden")})}};
z.e.hJ=function(){z.V.confirm("确定取消屏蔽？","取消屏蔽后，对方将可以关注你、向你发私信、评论你的回答、使用「@」提及你，邀请你回答问题。",function(a){a&&RS(this,!1)},this)};z.e.tl=function(){this.o().ya(window.document,"click",function(){this.qb.G(!1)})};z.e.kk=function(){var a=z.J("profile-side-op");a&&this.o().g(a,"click",this.bk)};z.e.JR=function(a){var b="";a.target===this.$N?b="time":a.target===this.aO?b="vote":a.target===this.ZN&&(b="ask");window.location.href="/people/"+z.Y[1]+"/answers?sort\x3d"+b};
z.e.bk=function(a){a=a.target.name;"block"===a?z.V.confirm("确定要屏蔽该用户？","屏蔽用户后，对方将不能关注你、向你发私信、评论你的实名回答、使用「@」提及你，邀请你回答问题，但仍然可以查看你的公开信息。",function(a){a&&RS(this,!0)},this):"cancel-block"===a&&this.hJ()};
z.e.UP=function(a){if(a&&a.target&&(a=z.Jr(this.h,a.target))){var b=z.L("zm-profile-fav-item-title",a),c=z.L("zm-profile-fav-item-des",a);b&&c&&"fav-edit"===a.name&&(b=b.innerHTML,c=c.innerHTML||"",a=[Number(a.getAttribute("data-id")),Number(a.getAttribute("data-public")),a.getAttribute("data-url-token"),Number(a.getAttribute("data-followers-num"))],z.vA(z.qA.ba(),b,c,a))}};z.x("ZH.entryProfile",function(){(new DS).init()});z.lg("page-profile");}).call(this, __z_z__);
//# sourceURL=/static/revved/-/js/closure/page-profile.e148b538.js