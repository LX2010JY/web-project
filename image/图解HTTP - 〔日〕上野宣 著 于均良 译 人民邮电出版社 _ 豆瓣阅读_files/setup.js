webpackJsonp([0],{0:function(t,e,n){"use strict";n.p=Ark.CDN_PUBLIC_PATH+"js/dist/reader/",n(1),n(14),n(18).initialize()},1:function(t,e,n){var i,r;i=[n(2),n(3),n(6),n(9)],r=function(t,_,$,e){return t.inhert=t.View.extend,t.ajax=function(t){_.extend(t,{processData:!0});var n=e.call(this,t),i=new $.Deferred,r=i.promise();return n.done(function(t,e,n){if(!t)return i.resolve(arguments);var r=!!t.r||!!t.error;return _.isUndefined(t.r)||delete t.r,r?i.reject(n,"error",t.msg||t.error||"出现了奇怪的错误, 请稍后再试"):i.resolve(t)}).fail(function(t,e,n){i.reject.apply(this,arguments)}),r},t}.apply(e,i),!(void 0!==r&&(t.exports=r))},9:function(t,e,n){var i,r;i=[n(6),n(10)],r=function($,t){function e(){var e=arguments,i=e[e.length-1]||{};if(i.arkWithDocReferer&&t("prev_referer",document.referrer,{path:"/","max-age":2}),i.type&&"GET"!==i.type.toUpperCase()&&(i.headers=$.extend({},i.headers,{"X-CSRF-Token":t("ck")})),t("profile")){var r=null;$.each(i,function(t,n){"dataFilter"===t&&(r=n,delete e[t])}),i=$.extend(i,{dataFilter:function(t,e){try{t=$.parseJSON(t)}catch(o){t=t}return n.e(1,function(e){var n=[e(11)];(function(e){e=e||Ark.profile,e.add({time:t.pt,uri:t.uri,type:i.type,stdout:t.profile})}).apply(null,n)}),null===r?t.rawData:r(t.rawData)}})}return $.ajax.apply($,e)}return e.post=function(t,n,i,r){return $.isFunction(n)&&(r=r||i,i=n,n=void 0),e({type:"POST",url:t,data:n,success:i,dataType:r||"json"})},e.get=function(t,n,i){return e({type:"GET",url:t,success:n,dataType:i||"json"})},e.methodMap={read:"GET",create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE"},e.request=function(t,n,i,r,o){return $.isFunction(i)&&(o=r,r=i,i={}),e($.extend({type:t,url:n,data:i,dataType:o||"text"},r))},e}.apply(e,i),!(void 0!==r&&(t.exports=r))},10:function(t,e,n){var i;"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};!function(r,o){i=function(){return o()}.call(e,n,e,t),!(void 0!==i&&(t.exports=i))}(void 0,function(){function t(t){var e=document.cookie.match(new RegExp("(?:\\s|^)"+t+"\\=([^;]*)"));return e?decodeURIComponent(e[1]):null}function e(t,e,n){n=n||{};var i,r,o,a=t+"="+encodeURIComponent(e),s=n.path?"; path="+n.path:"",c=n.domain?"; domain="+n.domain:"",u=n["max-age"],l=n.secure?"; secure":"";n.expires?o=n.expires:u&&(i=new Date,i.setTime(i.getTime()+1e3*u),o=i.toGMTString()),o&&(r="; expires="+o),document.cookie=[a,r,s,c,l].join("")}function n(t){e(t,"",{"max-age":0})}var i=function(n,i,r){return 1===arguments.length?t(n):e(n,i,r)};return i.get=t,i.set=e,i.remove=n,i})},12:function(t,e,n){var i,r;i=[n(13)],r=function(_){_=_||Ark._;var t={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"};for(var e in t)t[t[e]]=e;var n=/\\|'|\r|\n|\t|\u2028|\u2029/g,i=/\\(\\|'|r|n|t|u2028|u2029)/g,r=function(e){return e.replace(i,function(e,n){return t[n]})},o=function(e,i,o){o=_.extend(o||{},{evaluate:/\{\{([\s\S]+?)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,escape:/\{\{-([\s\S]+?)\}\}/g});var a="__p+='"+e.replace(n,function(e){return"\\"+t[e]}).replace(o.escape,function(t,e){return"'+\n_.escape("+r(e)+")+\n'"}).replace(o.interpolate,function(t,e){return"'+\n("+r(e)+")+\n'"}).replace(o.evaluate,function(t,e){return"';\n"+r(e)+"\n;__p+='"})+"';\n";o.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+a+"return __p;\n";var s=new Function(o.variable||"obj","_",a);if(i)return s(i,_);var c=function(t){return s.call(this,t,_)};return c.source="function("+(o.variable||"obj")+"){\n"+a+"}",c};return o}.apply(e,i),!(void 0!==r&&(t.exports=r))},13:function(t,e,n){var i,r;i=[],r=function(){var t={},e=Array.prototype,n=e.forEach,i=e.slice,r=t.each=function(t,e,i){if(t)if(n&&t.forEach===n)t.forEach(e,i);else if(t.length===+t.length)for(var r=0,o=t.length;r<o;r++)e.call(i,t[r],r,t);else for(var a in t)t.hasOwnProperty(a)&&e.call(i,t[a],a,t)};return t.isArray=Array.isArray||function(t){return"[object Array]"==={}.toString.call(t)},t.filter=function(t,n,i){var o=[];return e.filter?t.filter(n,i):(r(t,function(e,r){n.call(i,e,r,t)&&o.push(e)}),o)},t.extend=function(t){return r(i.call(arguments,1),function(e){for(var n in e)t[n]=e[n]}),t},t.escape=function(t){t=""+t||"";var e={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"};return t.replace(/[<>&'"]/g,function(t){return e[t]})},t.unescape=function(t){t=""+t||"";var e={"&amp;":"&","&lt;":"<","&gt;":">","&#39;":"'","&quot;":'"'},n=/(&amp;|&lt;|&gt;|&#39;|&quot;)/g;return t.replace(n,function(t){return e[t]})},t.now=Date.now||function(){return(new Date).getTime()},t.debounce=function(e,n,i){var r,o,a,s,c,u=function l(){var u=t.now()-s;u<n?r=setTimeout(l,n-u):(r=null,i||(c=e.apply(a,o),a=o=null))};return function(){a=this,o=arguments,s=t.now();var l=i&&!r;return r||(r=setTimeout(u,n)),l&&(c=e.apply(a,o),a=o=null),c}},t.throttle=function(e,n,i){var r,o,a,s=null,c=0;i=i||{};var u=function(){c=i.leading===!1?0:t.now(),s=null,a=e.apply(r,o),r=o=null};return function(){var l=t.now();c||i.leading!==!1||(c=l);var h=n-(l-c);return r=this,o=arguments,h<=0?(clearTimeout(s),s=null,c=l,a=e.apply(r,o),r=o=null):s||i.trailing===!1||(s=setTimeout(u,h)),a}},t}.apply(e,i),!(void 0!==r&&(t.exports=r))},14:function(t,e,n){(function(e){"use strict";t.exports=e.$=n(15)}).call(e,function(){return this}())},15:function(t,e,n){(function(e){t.exports=e.jQuery=n(16)}).call(e,function(){return this}())},16:function(t,e,n){var i,r;i=[n(6)],r=function($){function t(){return!1}var e=$.cleanData;$.cleanData=function(t){for(var n,i=0;null!=(n=t[i]);i++)try{$(n).triggerHandler("removing")}catch(r){}e(t)};var i=window,r=document,o=i.PointerEvent||i.MSPointerEvent,a=i.DocumentTouch&&r instanceof DocumentTouch,s="ontouchstart"in i||a,c=s||o,u=/mobile|ip(ad|hone|od)|android|silk/i.test(navigator.userAgent),l=!c||!u;return s?(n.e(2,function(t){var e=[t(17)];(function(t){t(document,{tapAlways:!1,preventMouse:!0})}).apply(null,e)}),l?$:($.fn.extend({on:function(e,n,i,r,o){var a,s;if("object"==typeof e){"string"!=typeof n&&(i=i||n,n=void 0);for(s in e)this.on(s,n,i,e[s],o);return this}if(null==i&&null==r?(r=n,i=n=void 0):null==r&&("string"==typeof n?(r=i,i=void 0):(r=i,i=n,n=void 0)),r===!1)r=t;else if(!r)return this;return 1===o&&(a=r,r=function(t){return $().off(t),a.apply(this,arguments)},r.guid=a.guid||(a.guid=$.guid++)),this.each(function(){e=/click/g.test(e)&&!/preventDefault/g.test(r)&&n?e.replace("click","tap"):e,$.event.add(this,e,r,i,n)})}}),$)):$}.apply(e,i),!(void 0!==r&&(t.exports=r))},18:function(t,e,n){var i,r;i=[n(6),n(2),n(3),n(21),n(22),n(24),n(19),n(32),n(193),n(51),n(323)],r=function($,t,_,e,n,i,r,o,a,s,c){function u(){t.sync=r.sync,t.fakeSync=r.fakeSync,a.checkStorageVersion(),o.fitForDesktop&&$("html").addClass("fit-for-desktop"),_.extend(n,{me:new c(e.me),navigate:function(){var t=n.router;t&&t.navigate.apply(t,arguments)}});var u=$("body");u.on("click",'a[href="#"]',function(t){t.preventDefault()}).on("click","[data-target-dialog=login]",function(){n.trigger("open:login-dialog")}).on("contextmenu dragstart","img, .pic",function(t){t.preventDefault()}),n.on("open:login-dialog",function(){var t=$(this).data("closable");s({closable:t})}),/msie 8/i.test(navigator.userAgent)&&u.on("selectstart",function(t){var e="TEXTAREA"===t.target.nodeName;if(!e)return!1}),i.initialize()}return{initialize:u}}.apply(e,i),!(void 0!==r&&(t.exports=r))},19:function(t,e,n){var i,r;i=[n(6),n(20)],r=function($,t){function e(t,e,n){var i=new $.Deferred,r=i.resolve().promise();return n.success&&r.done(n.success),n.error&&r.fail(n.error),r}function n(n){return n.fakeSync||n.collection&&n.collection.fakeSync?e:t}function i(t,e,i){return n(e).apply(this,[t,e,i])}return{sync:i,fakeSync:e}}.apply(e,i),!(void 0!==r&&(t.exports=r))},20:function(t,e,n){var i,r;i=[n(3),n(2)],r=function(_,t){var e=function(){throw new Error('A "url" property or function must be specified')},n={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"},i=function(i,r,o){var a=n[i],s={type:a,dataType:"json"};o=o||{},o.url||(s.url=_.result(r,"url")||e()),o.data||!r||"create"!==i&&"update"!==i&&"patch"!==i||(s.data=o.attrs||r.toJSON(o)),"PATCH"!==s.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(s.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var c=o.xhr=t.ajax(_.extend(s,o));return r.trigger("request",r,c,o),c};return i}.apply(e,i),!(void 0!==r&&(t.exports=r))},21:function(t,e,n){var i,r;i=[],r=function(){return window.Ark||{}}.apply(e,i),!(void 0!==r&&(t.exports=r))},22:function(t,e,n){var i,r;i=[n(23)],r=function(t){return t()}.apply(e,i),!(void 0!==r&&(t.exports=r))},23:function(t,e,n){var i,r;i=[n(6),n(3),n(2)],r=function($,_,t){var e=function(){this._cached={}};return _.extend(e.prototype,t.Events),_.extend(e.prototype,{init:function(t){this.namespace=t,_.extend(this,this.getAttrsFromNamespace())},getAttrsFromNamespace:function(){var e=this.namespace;return this._cached[e]?this._cached[e]:(this._cached[e]={vent:_.extend({},t.Events),_models:{}},this._cached[e])},setModel:function(t,e){this._models[t]=e,this.vent.trigger("model:"+t+":set",e)},getModel:function(t){if(!this._models[t])throw Error("model/"+t+" does not exist.");return this._models[t]},unsetModel:function(t){delete this._models[t]},hasModel:function(t){return this._models&&!!this._models[t]},getModelPromise:function(t){var e=$.Deferred();return this.hasModel(t)?e.resolve(this.getModel(t)):this.vent.once("model:"+t+":set",function(t){e.resolve(t)}),e.promise()}}),function(){return new e}}.apply(e,i),!(void 0!==r&&(t.exports=r))},24:function(t,e,n){var i,r;i=[n(2),n(6),n(3),n(21),n(22),n(27),n(28),n(9),n(29),n(25),n(32),n(33),n(34),n(37),n(59),n(69),n(51)],r=function(t,$,_,e,i,r,o,a,s,c,u,l,h,d,f,p,m){function g(t){a({type:"post",url:"/j/article_v2/read_probe",data:{aid:t}})}function v(){var t=b,n=window.location.pathname.replace(/[^\/]$/,"$&/")===t;!n&&e.works&&c.set("works",e.works),n&&!e.works&&(e.works=c.get("works")||{})}function y(){i.router=new E,s.hasPushState()||v(),t.history.start({pushState:!0,root:b})}var b="/reader/",C=/^\/reader\//,w=e.EBOOK_STYLE_SHEET,k=e.GALLERY_STYLE_SHEET,x=e.COLUMN_STYLE_SHEET,T=function(t){return{ebookId:t[0]}},S=function(t){return{columnId:t[0],ebookId:t[1]}},I=function(t,n){n=n||{urlArgsParser:T};var r=function(){var r=_.toArray(arguments),o=this,a=n.urlArgsParser(r),c=a.ebookId;this._ebookId=c,g(c);var u=this.getWorksType(c),l="c"===e.works.type&&!s.fitForMobile(),h={reading:w,gallery:k};l?P.use([w,x]):P.use(h[u]),i.init(u),this.readingCleanup(),this.initConfigModel({worksType:u,isChapter:n.isChapter,isLiteStyle:l}),$("html").toggleClass("justify-failed",s.justifyFailed()).toggleClass("has-bad-chinese-line-break",s.hasBadChineseLineBreak()),this.requireReadView(u,c,function(e){t.apply(o,[e].concat(r)),o.switchPageView(e.name)})};return r},A=function(t){var e={urlArgsParser:S,isChapter:!0};return I(function(e,n,i){var r=_.toArray(arguments);this._columnId=n,this.setChapterConfig(e),this.chapterAdapter=new p({columnId:n,chapterId:i}).render({canvas:e}),this.chapterAdapter.modelPromise.done(_.bind(function(){this._initColumnLayout(),t.apply(this,r)},this))},e)},P=new r([w,k,x]),E=t.Router.extend({routes:{"":"home","ebook/:ebookId/":"ebook","column/:columnId/chapter/:chapterId/":"chapter","notifications/":"notifications","ebook/:ebookId/recommendation/:rId/":"showRecommendation","ebook/:ebookId/show-underline/*query":"showUnderline","ebook/:ebookId/annotation/:annotationId/*query":"openSingleAnnotation","ebook/:ebookId/para-annotations/:paraId/":"openParaAnnotations","ebook/:ebookId/toc/:index/":"gotoToc","column/:columnId/chapter/:chapterId/list/":"chapterWithList","column/:columnId/chapter/:chapterId/recommendation/:rId/":"showChapterRecommendation","column/:columnId/chapter/:chapterId/show-underline/*query":"showChapterUnderline","column/:columnId/chapter/:chapterId/annotation/:annotationId/*query":"openChapterSingleAnnotation","column/:columnId/chapter/:chapterId/para-annotations/:paraId/":"openChapterParaAnnotations","ebook/:ebookId/page/:pageNumber/":"redirectToEbook","*actions":"redirectToHome"},initialize:function(){this.body=$("body"),this.viewNames=["readView","galleryView","notificationsView"];var t=this;$("body").on("click","a[data-permalink]",function(e){if(!(e.altkey||e.ctrlKey||e.metaKey||e.shiftKey)){e.preventDefault();var n=this.getAttribute("href").replace(C,"");t.navigate(n,{trigger:!0})}}).on("click","a[data-in-app-go-back]",function(e){if(e.preventDefault(),i.atLandingView){var n=this.getAttribute("href");t.navigate(n,!0)}else history.go(-1)}),this.bindLandingHandler()},bindLandingHandler:function(){function t(e){/^route:/.test(e)&&(i.atLandingView=!1,this.off("all",t))}function e(n){/^route:/.test(n)&&(this.off("all",e),this.on("all",t),i.atLandingView=!0)}this.on("all",e),this.on("all",this._trackPageview)},switchPageView:function(t){i.trigger("pageView:switched"),this.removeGalleryThemeClass(),_.each(this.viewNames,function(e){e!==t&&i[e]&&i[e].hide()}),i[t].show()},readingCleanup:function(){try{i.getModel("config").resetModel()}catch(t){i.setModel("config",new h)}i.hasModel("article")&&i.getModel("article").unbindAll(),this.cleanChapterAdapter()},initConfigModel:function(t){var e=i.getModel("config"),n="gallery"===t.worksType;e.set("isGallery",n).set("isChapter",!!t.isChapter),(t.isLiteStyle||s.fitForMobile())&&e.setIgnoreSavingKey("layout",!0),t.isLiteStyle&&e.set("layout","vertical"),s.fitForMobile()&&e.set("layout",n?"vertical":"horizontal")},removeGalleryThemeClass:function(){this.body.removeClass("day-theme night-theme")},home:function(){this.redirectToHome()},ebook:I(function(t,e){t.render(e)}),_initColumnLayout:function(){"c"!==e.works.type||s.fitForMobile()||(this.columnLayout=this.columnLayout||new f,this.columnLayout.render({model:this.chapterAdapter.columnModel}))},chapter:A(function(t,e,n){t.render(n)}),chapterWithList:A(function(t,e,n){t.renderThenOpenChapterList(n)}),setChapterConfig:function(t){var e=i.getModel("config");t.$el.addClass("is-chapter"),e.once("change:isChapter",function(){t.$el.removeClass("is-chapter")})},cleanChapterAdapter:function(){this.chapterAdapter&&(this.chapterAdapter.remove(),delete this.chapterAdapter,i.getModel("config").unset("isChapter"))},notifications:function(){i.notificationsView=i.notificationsView||new d,this.switchPageView("notificationsView")},showUnderline:I(function(t,e,n,i){var r=this.getUnderlineData(i);t.renderThenShowUnderline(e,r)}),showRecommendation:I(function(t,e,n){t.renderThenOpenRecommendation(e,n)}),openSingleAnnotation:I(function(t,e,n){u.fitForDesktop||this.redirectToEbook(e),t.renderThenOpenAnnotation(e,n)}),openParaAnnotations:I(function(t,e,n){u.fitForDesktop||this.redirectToEbook(e),t.renderThenOpenParaAnnotations(e,n)}),gotoToc:I(function(t,e,n){t.renderThenGotoChapter(e,n)}),showChapterRecommendation:A(function(t,e,n,i){t.renderThenOpenRecommendation(n,i)}),showChapterUnderline:A(function(t,e,n,i,r){var o=this.getUnderlineData(r);t.renderThenShowUnderline(n,o)}),openChapterSingleAnnotation:A(function(t,e,n,i){u.fitForDesktop||this.redirectToChapter(),t.renderThenOpenAnnotation(n,i)}),openChapterParaAnnotations:A(function(t,e,n,i){u.fitForDesktop||this.redirectToChapter(),t.renderThenOpenParaAnnotations(n,i)}),redirectToEbook:function(t){var e=["ebook",t,""].join("/");return this.navigate(e,{trigger:!0,replace:!0})},redirectToChapter:function(){var t=this.getBookUrl();return this.navigate(t,{trigger:!0,replace:!0})},getWorksType:function(t){var n={g:"gallery",t:"reading",c:"reading"},r=n.t;if(!s.hasPushState()&&e.works.id!==t)return this.redirectTryGetWorksType(),r;i.cachedWorksTypeSymobol||(i.cachedWorksTypeSymobol={});var o=i.cachedWorksTypeSymobol[t]||e.works.type;return i.cachedWorksTypeSymobol[t]=o,e.works=_.extend(e.works||{},{type:o}),n[o||"t"]},requireReadView:function(t,e,r){function o(t){i[s]=i[s]||new t,i[s].name=s,r(i[s])}var a={gallery:"galleryView",reading:"readView"},s=a[t];switch(s){case"readView":n.e(4,function(t){var e=[t(74)];o.apply(null,e)}.bind(this));break;case"galleryView":n.e(7,function(t){var e=[t(242)];o.apply(null,e)}.bind(this));break;default:this.redirectToHome()}},_trackPageview:function(){var e=t.history.getFragment();l._trackPageview(b+e)},redirectToHome:function(){e.me.isAnonymous?m({closable:!1}):location.href="/reader/all"},redirectTryGetWorksType:function(){var e=t.history.getFragment(),n=t.history.root;window.location.replace(n+e+window.location.search)},redirectToNotifications:function(){this.navigate("notifications/",{trigger:!0})},cleanUrl:function(t){t=_.extend({trigger:!1,replace:!0},t),this.navigate(this.getBookUrl({ignoreSearch:!0}),t)},getBookUrl:function(t){t=t||{};var e,n=window.location.search||"",r=i.getModel("config");return n=t.ignoreSearch?"":n,e=r.get("isChapter")?["column",this._columnId,"chapter",this._ebookId,""].join("/"):["ebook",this._ebookId,""].join("/"),e+n},getUnderlineData:function(t){var e=o.deparam(t||""),n={};_.each(["startContainerId","endContainerId","startOffset","endOffset"],function(t){n[t]=+e[t]});var i=e.middleContainers;return n.middleContainers=i?_.map(i.split(","),function(t){return+t}):[],n},getReviewsUrl:function(){var t="/"+this.getBookUrl({ignoreSearch:!0});return t+=i.getModel("config").get("isChapter")?"comments":"reviews?sort=score"},getQuestionsUrl:function(){return"/"+this.getBookUrl({ignoreSearch:!0})+"questions"}});return{initialize:y}}.apply(e,i),!(void 0!==r&&(t.exports=r))},25:function(t,e,n){var i,r;i=[n(26)],r=function(t){return new t(!0,"session")}.apply(e,i),!(void 0!==r&&(t.exports=r))},26:function(t,e,n){var i;(function($){"use strict";i=function(){function t(t,e){"session"!==e&&(e="local"),this._cache={},this._wantsWebStorage="undefined"==typeof t||t,this._useWebStorage=this._wantsWebStorage&&n,n&&(this._storage=window[e+"Storage"])}var e={has:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},keys:Object.keys||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var n=[];for(var i in t){if(!e.has(t,i))return;n.push(i)}return n},isObject:function(t){return t===Object(t)}},n=function(){try{var t="Storage"in window&&null!==window.Storage;return t&&(localStorage.setItem("storage",""),localStorage.removeItem("storage")),t}catch(e){return!1}}();return $.extend(t.prototype,{setStorageObject:function(t,e){this._storage.setItem(t,JSON.stringify(e))},getStorageObject:function(t,e){var n=this._storage.getItem(t);try{n=JSON.parse(n)}catch(i){n=null}return n},getStorageKeys:function(){for(var t=[],e=0,n=this._storage.length;e<n;e++)t.push(this._storage.key(e));return t},get:function(t){if(this._useWebStorage){var e=this._storage.getItem(t+"___isObject");return e?this.getStorageObject(t)||void 0:this._storage.getItem(t)||void 0}return this._cache[t]||void 0},set:function(t,n){if(this._useWebStorage)if(n&&e.isObject(n))this.setStorageObject(t,n),this._storage.setItem(t+"___isObject",!0);else try{this._storage.setItem(t,n)}catch(i){}else this._cache[t]=n;return n},remove:function(t){this._useWebStorage&&(this._storage.removeItem(t),this._storage.removeItem(t+"___isObject")),delete this._cache[t]},length:function(){return this._useWebStorage?this._storage.length:this._cache.length},keys:function(){return this._useWebStorage?this.getStorageKeys():e.keys(this._cache)},clear:function(){this._useWebStorage&&this._storage.clear(),this._cache={}}}),t}.call(e,n,e,t),!(void 0!==i&&(t.exports=i))}).call(e,n(6))},27:function(t,e,n){var i,r;i=[n(3)],r=function(_){var t=function(t,e){this.styleSheets=this.getStyleSheets(t),e?this.use(e):this.disableAll()};return _.extend(t.prototype,{getStyleSheets:function(t){var e=document.styleSheets,n={};return _.each(e,function(e){var i=e.ownerNode||e.owningElement;if(i.id){var r=i.id;_.contains(t,r)&&(n[r]=e)}}),n},use:function(t){_.isString(t)&&(t=[t]),this.currentStyleSheet&&!_.difference(this.currentStyleSheet,t).length||(this.currentStyleSheet=t,this.disableAll(),_.each(this.styleSheets,function(e,n){_.each(t,function(t){t===n&&(e.disabled=!1)})}))},disableAll:function(){_.each(this.styleSheets,function(t,e){t.disabled=!0})}}),t}.apply(e,i),!(void 0!==r&&(t.exports=r))},28:function(t,e,n){var i;"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};!function(r,o){i=function(){return o()}.call(e,n,e,t),!(void 0!==i&&(t.exports=i))}(void 0,function(){function t(t){return t.replace(/[\/]+/g,"/").replace(/\/\?/g,"?").replace(/\/\#/g,"#").replace(/\:\//g,"://")}var e={};e.getURLParameter=function(t,e){e=e||location.search;var n=e.match(RegExp(t+"=(.+?)(&|$)"));return n?decodeURIComponent(n[1]):null};var n=/\+/g;e.deparam=function(t){for(var e={},i=t.replace(n," ").split("&"),r=0,o=i.length;r<o;r++){var a=i[r],s=a.split("="),c=decodeURIComponent([s[0]]),u=decodeURIComponent([s[1]]);e[c]=u}return e};var i=e.join=function(){var e=[].slice.call(arguments,0).join("/");return t(e)};e.addParam=function(t,e){var n="";for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];""!==r&&"undefined"!=typeof r&&(n&&(n+="&"),n+=encodeURIComponent(i)+"="+encodeURIComponent(r))}if(!n)return t;var o="",a="",s=t,c=s.indexOf("#"),u=s.indexOf("?");return c!==-1&&(o=s.substr(c),s=s.slice(0,c)),u!==-1&&(a=s.substr(u),s=s.slice(0,u)),s+(a?a+"&"+n:"?"+n)+(o?o:"")};var r=e.hasSameOrigin=function(t,e){if("/"===t[0])return!0;var n=new RegExp("^"+e);return n.test(t)};e.getRelativeUrl=function(t,e){return"/"!==t[0]&&r(t,e)?i("/",t.substr(e.length)):t};var o=/^\/?/;return e.getBackboneFragment=function(t){return t.replace(o,"")},e})},29:function(t,e,n){var i,r;i=[n(6),n(3),n(30),n(31)],r=function($,_,t,e){return _.extend({fitForMobile:_.memoize(function(){return e("screen and (-webkit-min-device-pixel-ratio: 1.1) and (max-width: 720px), screen and (max-device-width: 480px)").matches})},t)}.apply(e,i),!(void 0!==r&&(t.exports=r))},30:function(t,e,n){var i,r;i=[],r=function(){var t={},e=window,n=document,i=["webkit","moz"],r=navigator.userAgent,o=/\[Ark(?:[\w-]*)\/([\d.]+[\w-]*)\]/,a=/MicroMessenger/i,s=/Weibo/i,c=/com\.douban\.frodo/i;t.hasTouch=function(){return!!("ontouchstart"in e||(e.PointerEvent||e.MSPointerEvent)&&/IEMobile/.test(r)||e.DocumentTouch&&n instanceof DocumentTouch)},t.hasPushState=function(){return!(!e.history||!e.history.pushState)},t.canFullscreen=function(){for(var t=0;t<i.length;t++)if(n[i[t]+"CancelFullScreen"])return!0;return!!document.cancelFullScreen||!1},t.standalone=function(){return e.navigator.standalone},t.hasOrientationEvent=function(){return!!("DeviceOrientationEvent"in e)},t.hasBadChineseLineBreak=function(){var t=["<span>禁</span>","<span>则</span>","<span>，</span>","<span>换</span>","<span>行</span>","<span>问</span>","<span>题</span>"," ","<span>abcd</span>","<span>,</span>"].join(""),e=["position:absolute","font-size:12px","width:2em","visibility:hidden","left: 0"].join(";"),n=document.createElement("div");n.style.cssText=e,n.innerHTML=t,document.body.appendChild(n);var i=n.children[2],r=n.children[8],o=n.children[3],a=n.children[4],s=0===i.getBoundingClientRect().left||0===r.getBoundingClientRect().left,c=o.getBoundingClientRect().top!==a.getBoundingClientRect().top;return document.body.removeChild(n),s||c},t.justifyFailed=function(){var t=["position:absolute","font-size:12px","width:2.3em","visibility:hidden","text-align:justify","text-justify:inter-ideograph","-ms-text-justify:inter-ideograph"].join(";"),e=document.createElement("div");e.style.cssText=t,e.innerHTML=Array(4).join("<span>测</span>"),document.body.appendChild(e);var n=e.children[0],i=e.children[1],r=n.getBoundingClientRect(),o=i.getBoundingClientRect(),a=o.left-r.right,s=r.width||r.right-r.left,c=o.width||o.right-o.left;return a=a||s-c,document.body.removeChild(e),a<1},t.checkWebkitScrollNative=function(){if("WebkitOverflowScrolling"in document.documentElement.style)return!0;if(r.indexOf("Android")>=0){var t=parseFloat(r.slice(r.indexOf("Android")+8));if(t<3)return!1}return!0},t.isWeixin=function(){return a.test(r)},t.isWeibo=function(){return s.test(r)},t.isFrodo=function(){return c.test(r)},t.isInApp=function(){return o.test(r)},t.isMobile=function(){return this.isAndroid||this.isiPhone},t.isRetina=function(){var t="(-webkit-min-device-pixel-ratio: 1.5), \t       (min--moz-device-pixel-ratio: 1.5), \t       (-o-min-device-pixel-ratio: 3/2), \t       (min-resolution: 1.5dppx)";return e.devicePixelRatio>1||!(!e.matchMedia||!e.matchMedia(t).matches)};for(var u=["iPhone","Android","iPad"],l=0,h=u.length;l<h;l++){var d=u[l];t["is"+d]=new RegExp(d,"i").test(r)}return t.hasPinchZoom=function(){if(t.isiPhone)return!0;if(r.indexOf("Android")>=0){var e=parseFloat(r.slice(r.indexOf("Android")+8));if(e>=4)return!0}},t.hasWebStorage=function(){try{var t="Storage"in window&&null!==window.Storage;return t&&(localStorage.setItem("storage",""),localStorage.removeItem("storage")),t}catch(e){return!1}},t.isApplePhone=t.isiPhone,t}.apply(e,i),!(void 0!==r&&(t.exports=r))},31:function(t,e,n){var i;i=function(){var t,e=document,n=e.documentElement,i=n.firstElementChild||n.firstChild,r=e.createElement("body"),o=e.createElement("div");o.id="mq-test-1",o.style.cssText="position:absolute;top:-100em",r.style.background="none",r.appendChild(o);var a=window.matchMedia||function(e){return o.innerHTML='&shy;<style media="'+e+'">#mq-test-1{width:42px;}</style>',n.insertBefore(r,i),t=42===o.offsetWidth,n.removeChild(r),{matches:t,media:e}};return a}.call(e,n,e,t),!(void 0!==i&&(t.exports=i))},32:function(t,e,n){var i,r;i=[n(6),n(3),n(2),n(29),n(31)],r=function($,_,t,e,n){var i=navigator.userAgent,r=/CriOS/gi.test(i),o=(/Window NT/gi.test(i)&&!/ARM/gi.test(i),/linux/i.test(i)&&!e.isAndroid,i.indexOf("CrOS")!==-1,/mobile|ip(ad|hone|od)|android|silk/i.test(i)),a=e.isApplePhone&&!r?60:0;return{deviceOffset:a,fitForMobile:e.fitForMobile(),fitForDesktop:!o}}.apply(e,i),!(void 0!==r&&(t.exports=r))},33:function(t,e,n){var i;i=function(){var t={};return t._trackPageview=function(t){t=t.replace(/page.*/,""),ga("send","pageview","/"+t)},t._trackEvent=function(t,e){"undefined"!=typeof e&&null!==e||(e=document.title),"number"==typeof e&&(e=e.toString()),ga("send","event","reader",t,e)},t._trackTiming=function(t,e,n,i){"number"!=typeof e&&(n=parseInt(n,10)),"undefined"!=typeof n&&null!==n||(n=document.title),"number"==typeof n&&(n=n.toString()),ga("send","timing","reader",t,e,n)},t}.call(e,n,e,t),!(void 0!==i&&(t.exports=i))},34:function(t,e,n){var i,r;i=[n(3),n(2),n(10),n(35),n(32),n(36)],r=function(_,t,e,n,i,r){var o="hsag",a="hst",s={pageWidth:43.375,pageGutter:0,pageOffset:0,lineHeight:2,pageHeight:768,isRecommendation:!1},c=t.Model.extend({defaults:function(){return _.defaults({layout:n.get("layout")||"horizontal",annotationsConfig:new r,hasShownAnnotationGuide:this.hasShownAnnotationGuide(),isNewUser:this.isNewUser()},s)},storageKeys:["layout"],ignoreSavingKeys:{},initialize:function(){i.fitForMobile&&(this.ignoreSavingKeys.layout=!0,this.set("layout","horizontal")),this.bindLocalStorageData(),this.bindCookieData()},bindLocalStorageData:function(){_.each(this.storageKeys,function(t){this.on("change:"+t,function(e,i){this.ignoreSavingKeys[t]||n.set(t,i)})},this)},bindCookieData:function(){this.on("change:hasShownAnnotationGuide",function(t,e){this.ignoreSavingKeys.hasShownAnnotationGuide||e&&this.setCookieOn(o)},this).on("change:isNewUser",function(t,e){this.ignoreSavingKeys.isNewUser||e||this.setCookieOn(a)},this)},getPageHeightEm:function(){return this.get("pageHeight")/16},isNewUser:function(){return!this.hasCookieSet(a)},hasShownAnnotationGuide:function(){return this.hasCookieSet(o)},hasCookieSet:function(t){var n=e(t);return n},setCookieOn:function(t){return e(t,1,{"max-age":31536e3,path:"/reader"}),this},resetModel:function(){return this.unset("ignoreSaveProgress",{silent:!0}).unset("ignoreGuide",{silent:!0}),this},setIgnoreSavingKey:function(t,e){return this.ignoreSavingKeys[t]=e,this}});return c}.apply(e,i),!(void 0!==r&&(t.exports=r))},35:function(t,e,n){var i,r;i=[n(26)],r=function(t){return new t(!0,"local")}.apply(e,i),!(void 0!==r&&(t.exports=r))},36:function(t,e,n){var i,r;i=[n(2),n(3),n(21),n(35)],r=function(t,_,e,n){var i=t.Model.extend({storageKey:"annotationsConfig",defaults:function(){return _.defaults(this.getStorageData(),{showOthers:!0,othersFilter:"all"})},initialize:function(){this.on("change",this.setStorageData)},isFilterOut:function(t){var e,n=this.toJSON();return e=n.showOthers?"followOnly"!==n.othersFilter||this.filterByTags(t,["mine","favorite","following"]):this.filterByTags(t,["mine","favorite"]),!e},filterByTags:function(t,e){return!!_.intersection(e,t.get("tags")).length},getStorageData:function(){if(e.me.isAnonymous)return{};var t=n.get(this.storageKey);return t?JSON.parse(t):{}},setStorageData:function(t){n.set(this.storageKey,JSON.stringify(t.toJSON()))}});return i}.apply(e,i),!(void 0!==r&&(t.exports=r))},37:function(t,e,n){var i,r;i=[n(3),n(2),n(6),n(22),n(38),n(40),n(56)],r=function(_,t,$,e,n,i,r){var o={loading:"载入中…",empty:"你还没有任何阅读提醒",nonEmpty:""},a=t.View.extend({el:"#notifications",initialize:function(){this.docElement=$(document.documentElement),this.notificationList=new r({el:this.$(".notifications-list")}),this.msgText=this.$(".notifications-msg"),this.bindCollection()},bindCollection:function(){return this.collection=new n,this.listenTo(this.collection,"add",this.appendItem).listenTo(this.collection,"request",function(){this.changeListState("loading")}).listenTo(this.collection,"sync",function(t,e){e.length?this.changeListState("nonEmpty"):this.changeListState("empty")}),this},appendItem:function(t){this.notificationList.appendToTopic(new i({model:t}).render().el,t.get("time"))},refreshList:function(){this.collection.set([],{hardRemove:!0}),this.notificationList.reset(),this.collection.fetchMore()},changeListState:function(t){this.listState!==t&&(this.listState=t,this.msgText.text(o[t]),this.$el.toggleClass("has-notification","nonEmpty"===t))},show:function(){return document.title="阅读提醒",this.refreshList(),this.docElement.addClass("notifications-view"),this.$el.show(),$("body").scrollTop(0),this},hide:function(){return this.docElement.removeClass("notifications-view"),this.$el.hide(),this}});return a}.apply(e,i),!(void 0!==r&&(t.exports=r))},38:function(t,e,n){var i,r;i=[n(2),n(3),n(6),n(39),n(9)],r=function(t,_,$,e,n){return t.Collection.extend({model:e,url:"/j/notification/get_notifications",limit:20,initialize:function(t,e){this.start=0,this.on("remove",function(){this.start--})},fetchMore:function(t,e){t=t||this.start,e=e||this.limit;var n=this;return this.fetch({data:{start:t,limit:e}}).done(function(t){n.start+=t.length})}})}.apply(e,i),!(void 0!==r&&(t.exports=r))},39:function(t,e,n){var i,r;i=[n(2),n(3),n(9)],r=function(t,_,e){return t.Model.extend({stopNotifyUrl:"/j/notification/not_noti_again",initialize:function(){this.on("destroy",this.stopNotify)},stopNotify:function(){return e.post(this.stopNotifyUrl,{nid:this.get("nid")})},typeIs:function(t){return this.get("subscribe_reason")===t},isAuthor:function(){return this.typeIs("author")}})}.apply(e,i),!(void 0!==r&&(t.exports=r))},40:function(t,e,n){var i,r;i=[n(3),n(2),n(6),n(22),n(9),n(41),n(45)],r=function(_,t,$,e,n,i,r){var o=t.View.extend({tagName:"li",className:"notification-item collapsed",tmpl:$("#tmpl-notification-item").html(),events:{"click .stop-notify":"stopNotify","click .reply-count, .annotation-link":"openTab",click:"expandComments"},initialize:function(){this.listenTo(this.model,"remove",this.onModelRemove)},render:function(){var t=this.model.toJSON();return t.isAuthor=this.model.isAuthor(),t.annotation_url=this.getSingleAnnotationUrl(t.works_id,t.annotation_id),this.$el.html(_.template(this.tmpl,t)),this.$el.toggleClass("new",!t.is_read),this.detailElem=this.$(".detail"),
this},stopNotify:function(t){t.stopPropagation(),this.model.destroy({wait:!0})},expandComments:function(){if(!this.commentsView){var t=this.model.get("nid");this.commentsView=new r({markingModel:this.createMarkingModel(this.model),className:"notification-comments-view",commentTargetInfo:this.getTargetInfo(this.model),commentTmpl:$("#tmpl-notification-comment-item").html(),commentsUrl:function(){return"/j/notification/get_notification_comments?nid="+t}}),this.$(".notification-comments").append(this.commentsView.render().el)}this.$el.removeClass("new").removeClass("collapsed"),this.detailElem.show()},getTargetInfo:function(t){return{article:{authorId:t.get("works_author_id")}}},createMarkingModel:function(t){var e=t.toJSON();return new i({id:e.annotation_id},{articleId:e.works_id,paragraphsIndex:[]})},onModelRemove:function(t,e,n){return n.hardRemove?void this.remove():void this.$el.fadeOut(400,function(){this.remove()})},openTab:function(t){t.stopPropagation(),this.$el.removeClass("new")},getSingleAnnotationUrl:function(){var t="?ici=annotation-reply&icn=noti",e=this.model.toJSON(),n=e.works_is_chapter,i=e.annotation_id,r=e.works_id,o=n?"/reader/column/"+e.works_column_id+"/chapter/"+r:"/reader/ebook/"+r,a="/annotation/"+i+"/";return o+a+t}});return o}.apply(e,i),!(void 0!==r&&(t.exports=r))},41:function(t,e,n){var i,r;i=[n(6),n(2),n(3),n(21),n(9),n(42),n(43),n(44)],r=function($,t,_,e,n,i,r,o){var a=["owner","tags","n_favorites","n_comments","open_on_render","is_recommendation","is_from_url"],s=["mine","favorite","following","hot","others"],c={mine:_.object(["share","comment","edit","delete"],"1111"),others:_.object(["favorite","share","comment"],"111"),underline:_.object(["share","delete"],"11")},u={mine:c.mine,favorite:c.others,following:c.others,hot:c.others,others:c.others,underline:c.underline};e.me.isAdmin&&(c.others["delete"]=1);var l={avatar:e.me.avatar,name:e.me.name,user_id:e.me.id},h={note:"",middleContainers:[],startOffset:0,endOffset:1/0,n_favorites:0,n_comments:0,tags:[],visible_private:"",open_on_render:!1,is_recommendation:!1,is_from_url:!1},d=new RegExp(["^((?:https?|ftp)://[-A-Z0-9+&@#/%?=()~_|!:,.;]*[-A-Z0-9+&@#/%=~()_|])$"].join(""),"i"),f=/^[\w\s()\-–,.?!"']+$/,p=i.extend({defaults:function(){return _.extend(_.clone(h),{owner:_.clone(l),create_time:r()})},initialize:function(t,e){e.fakeSync&&(this.fakeSync=e.fakeSync),this.articleId=e.articleId||this.collection&&this.collection.articleId,this.paragraphsIndex=e.paragraphsIndex||this.collection&&this.collection.paragraphsIndex,this.on("change",function(t,e){this.updateRange();var n=_.keys(this.changedAttributes()),i=["id","r"],r=_.difference(n,a.concat(i));r.length&&(delete e.success,delete e.error,delete e.type,delete e.data,delete e.xhr,this.trigger("effectiveChange",t,e))},this),this.on("add change:tags",this.sortTags,this),_.bindAll(this,"merge","comparePoints")},url:function(){return"/j/article_v2/"+this.articleId+"/annotation"},favoriteUrl:function(){return"/j/annotation/"+this.id+"/favorite"},isRecommendation:function(){return this.get("is_recommendation")},isFromUrl:function(){return this.get("is_from_url")},isUnderline:function(){return"underline"===this.get("type")},isNote:function(){return"note"===this.get("type")},isSelection:function(){return"selection"===this.get("type")},isFavorited:function(){return this.hasTag("favorite")},isFollowing:function(){return this.hasTag("following")},isMine:function(){return this.hasTag("mine")},isOthers:function(){return!this.get("tags").length},isPrivate:function(){return!!this.get("visible_private")},hasTag:function(t){return _.contains(this.get("tags"),t)},validate:function(t){if(t.startContainerId===t.endContainerId&&t.startOffset>t.endOffset)return"Invalid: End before it starts"},getStamp:function(){var t=new o({pid:this.get("endContainerId"),offset:this.get("endOffset")});return t},getRanges:function(){return this._ranges||this.updateRange(),_.clone(this._ranges)},updateRange:function(){var t=this.toJSON();this._ranges={},this._setUpParaData(this._ranges,t.startContainerId,{start:t.startOffset}),this._setUpParaData(this._ranges,t.endContainerId,{end:t.endOffset}),_.each(this.getContainerIds(),function(t){this._setUpParaData(this._ranges,t,{start:h.startOffset,end:h.endOffset})},this)},_setUpParaData:function(t,e,n){e=""+e,t[e]=_.defaults({},t[e],n)},setViaPoints:function(t,e){var n={startContainerId:t.containerId,endContainerId:e.containerId,startOffset:t.offset,endOffset:e.offset};return n.middleContainers=this.getMiddleContainers(n),this.set(n)},getPoints:function(){var t=this.toJSON();return{start:{containerId:t.startContainerId,offset:t.startOffset},end:{containerId:t.endContainerId,offset:t.endOffset}}},getMiddleContainers:function(t){var e=this.getCidIndex(t.startContainerId),n=this.getCidIndex(t.endContainerId);return e<0||n<0?[]:this.paragraphsIndex.slice(e+1,n)},getContainerIds:function(){var t=this.toJSON();return _.uniq([t.startContainerId].concat(t.middleContainers).concat([t.endContainerId]))},checkConflict:function(t){var e=this.getPoints(),n=t.getPoints();return!(this.comparePoints(e.start,n.end)*this.comparePoints(e.end,n.start)>0)},comparePoints:function(t,e){return t.containerId===e.containerId?t.offset-e.offset:this.getCidIndex(t.containerId)-this.getCidIndex(e.containerId)},getCidIndex:function(t){return t+="",_.indexOf(this.paragraphsIndex,t)},destroy:function(e){return e=this._mixInData(e,{id:this.id}),t.Model.prototype.destroy.call(this,e)},save:function(e,n){var i,r=_.extend(this.omit(a),e);return n&&n.sharing&&(i=JSON.stringify(n.sharing)),this.isNew()||(r.action="update"),n=this._mixInData(n,{annotation:JSON.stringify(r)},i?{sharing:i}:""),t.Model.prototype.save.call(this,e,n)},editFavorite:function(t){var e=t?"PUT":"DELETE",i=_.result(this,"favoriteUrl"),r=this,o=this.isOthers();return this.isFavoriting=!0,n.request(e,i,{},{},"json").done(function(e){e.r||(r.addFavorite(t),t&&o&&r.collection.broadcastWithPid("othersNote:{{pid}}:favorited",r))}).always(function(t){r.isFavoriting=!1})},_mixInData:function(t,e){return t=t?_.clone(t):{},_.each(_.rest(arguments),function(e){t.data=_.extend({},t.data,e)}),t},merge:function(t){var e=[],n=[];_.each(t.concat(this),function(t){var i=t.getPoints();e.push(i.start),n.push(i.end)}),_.each(t,function(t){t.destroy()});var i=_.first(e.sort(this.comparePoints)),r=_.last(n.sort(this.comparePoints));this.setViaPoints(i,r)},sortTags:function(){if(!this.isSelection()){var t=this.get("tags");t=_.intersection(s,t),this.set("tags",t,{silent:!0})}},getShowTag:function(){return this.get("tags")[0]||"others"},getActionsList:function(){return this.isUnderline()?u.underline:u[this.getShowTag()]},addFavorite:function(t){var e=t?1:-1,n=_.clone(this.get("tags")),i=this.get("n_favorites");t?n.push("favorite"):n=_.without(n,"favorite"),this.set("tags",n),this.set("n_favorites",i+e)},addCommentNum:function(t){var e=this.get("n_comments");this.set("n_comments",e+t)},setCommentsNum:function(t){this.set("n_comments",t)},plainTextIsUrl:function(){if(this.get("middleContainers").length)return!1;var t=$.trim(this.getTextFromRanges());return d.test(t)},plainTextIsEnglish:function(){if(this.get("middleContainers").length)return!1;var t=$.trim(this.getTextFromRanges());return t.length>1&&t.length<100&&f.test(t)}}),m={};m.getPlainText={getTextFromRanges:function(){var t="",e=this;return _.each(this.getContainerIds(),function(n){var i=$("p[data-pid="+n+"]").first(),r=e._ranges[n];if(!r.start&&r.end===Number.MAX_VALUE)return void(t+="\n"+e.getTextFromPara(i));var o,a=0;t&&(t+="\n"),_.each(i.find(".word"),function(n){o=$(n),a=o.data("offset"),a>=r.start&&a<=r.end&&(t+=e.getTextFromPara(o))})}),t.length>300&&(t=t.substr(0,300)+"..."),t},getTextFromPara:function(t){var e,n=$(t),i='[type="math/tex"]',r=n.find(i);return r.length?(e=n.clone(),e.find(i).each(function(){var t=$(this),e=t.closest(".word");e.html(t.html())}),e.text()):n.text()}};var g={};return e.me.isAnonymous&&(p.prototype.save=function(){return $.Deferred().resolve().promise()}),_.extend(p.prototype,m.getPlainText,g),p}.apply(e,i),!(void 0!==r&&(t.exports=r))},42:function(t,e,n){var i,r;i=[n(2),n(6)],r=function(t,$){return t.Model.extend({toJSON:function(){return $.extend(!0,{},this.attributes)}})}.apply(e,i),!(void 0!==r&&(t.exports=r))},43:function(t,e,n){var i;i=function(){function t(t){var e=String(t);return 1===e.length&&(e="0"+e),e}return Date.prototype.toISOString?function(){return(new Date).toISOString()}:function(){var e=new Date;return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+String((e.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}}.call(e,n,e,t),!(void 0!==i&&(t.exports=i))},44:function(t,e,n){var i,r;i=[n(2),n(3)],r=function(t,_){function e(t){t=_.defaults(t||{},n),this.setAttrs(t)}var n={pid:"",offset:null,type:"",isFromUrl:!1,isRecommendation:!1,annotation:null};return _.extend(e.prototype,{setAttrs:function(t){return _.extend(this,t),this.setAnnotation(t.annotation),this},setAnnotation:function(t){if(t=t||this.annotation)return this.pid=t.endContainerId,this.offset=t.endOffset,t.type=t.type||"rec_underline",t.is_recommendation=this.isRecommendation,t.is_from_url=this.isFromUrl,this.isRecommendation&&"note"===t.type&&(t.open_on_render=!0),this.annotation=_.clone(t),this},ignoreSaveProgress:function(){return this.isRecommendation||this.isFromUrl},getAnnotationJson:function(){return _.clone(this.annotation)},hasAnnotation:function(){return!!this.annotation},annotationIsNote:function(){return"note"===this.annotation.type},annotationReadable:function(){if(!this.hasAnnotation())return!1;var t=this.annotation;return!this._annotationInvisible(t)&&!this._annotationDeleted(t)},_annotationInvisible:function(t){return t.visible_private&&!_.contains(t.tags,"mine")},_annotationDeleted:function(t){return t.is_deleted}}),e}.apply(e,i),!(void 0!==r&&(t.exports=r))},45:function(t,e,n){var i,r;i=[n(6),n(2),n(3),n(21),n(46),n(47),n(48),n(50)],r=function($,t,_,e,n,i,r,o){var a=t.View.extend({className:"annotation-comments-panel",tmplForm:$("#tmpl-annotation-comments-form").html(),initialize:function(t){_.bindAll(this,"updateListHeight"),this.markingModel=t.markingModel,this.commentFormIsTop=t.commentFormIsTop,this.commentTmpl=t.commentTmpl,this.comments=new n([],{annotationId:this.markingModel.id}),t.commentsUrl&&(this.comments.url=t.commentsUrl),this.commentTargetInfo=t.commentTargetInfo,this.listenTo(this.comments,"add",this.appendCommentModel),this.listenTo(this.comments,"remove",function(t,e){this.markingModel.setCommentsNum(e.length)}),this.comments.fetch(),$(window).on("resize.annotationComments",_.throttle(this.updateListHeight,200))},events:{"submit .comment-form":"submitComment"},render:function(){var t=$("<ul>",{"class":"comments-list"}),e=$("<form>",{"class":"comment-form"}).html(this.tmplForm),n=[t,e];return this.commentFormIsTop&&_(n).reverse(),_(n).each(function(t){this.$el.append(t)},this),this.form=e,this.commentsList=t,this},appendCommentModel:function(t,e){var n=new r({model:t,tmpl:this.commentTmpl,targetInfo:this.commentTargetInfo});this.markingModel.setCommentsNum(e.length),this.commentsList[this.commentFormIsTop?"prepend":"append"](n.render().el)},updateListHeight:function(){var t=this.form.outerHeight(!0),e=this.commentsList.offset().top,n=$(window).height();this.commentsList.css("max-height",n-e-t)},submitComment:function(t){t.preventDefault();var e=$(t.target),n=(e.find("input[type=submit]"),e.find("input[name=text]")),i=$.trim(n.val()),r=this;if(i.length&&!this.formDisabled){this.formDisabled=!0;var o=new this.comments.model({text:i},{annotationId:this.comments.annotationId});o.save().done(function(){n.val(""),n.blur(),r.comments.add(o),r.commentsList.scrollTop(r.commentsList[0].scrollHeight)}).always(function(){r.formDisabled=!1})}},remove:function(){$(window).off("resize.annotationComments"),t.View.prototype.remove.call(this)}}),s=function(){return o.openLoginAndSignup(),!1},c={};return e.me.isAnonymous&&(a.prototype.events["focus input:text"]="focusInput",_.each(["submitComment","focusInput"],function(t){c[t]=s})),_.extend(a.prototype,c),a}.apply(e,i),!(void 0!==r&&(t.exports=r))},46:function(t,e,n){var i,r;i=[n(2),n(3),n(47)],r=function(t,_,e){var n=t.Collection.extend({url:function(){return" /j/annotation/"+this.annotationId+"/comment/"},model:e,initialize:function(t,e){this.annotationId=e.annotationId}});return n}.apply(e,i),!(void 0!==r&&(t.exports=r))},47:function(t,e,n){var i,r;i=[n(2),n(3)],r=function(t,_){var e=t.Model.extend({urlRoot:function(){return"/j/annotation/"+this.annotationId+"/comment/"},initialize:function(t,e){this.annotationId=e.annotationId||this.collection.annotationId}});return e}.apply(e,i),!(void 0!==r&&(t.exports=r))},48:function(t,e,n){var i,r;i=[n(6),n(2),n(3),n(21),n(22),n(49)],r=function($,t,_,e,n,i){var r=t.View.extend({tagName:"li",className:"comment-item",tmpl:$("#tmpl-annotation-comment-item").html(),initialize:function(t){this.listenTo(this.model,"destroy",this.remove),t.tmpl&&(this.tmpl=t.tmpl),this.targetInfo=t.targetInfo},events:{"click .delete-comment":"deleteComment"},render:function(){var t=this.model.toJSON(),n=t.author.user_id;return t.isMine=n===e.me.id,t.isArticleAuthor=this.isArticleAuthor(n),t.isAdmin=e.me.isAdmin,this.$el.html(_.template(this.tmpl,_.extend({autoLink:i},t))),this},isArticleAuthor:function(t){return!(!this.targetInfo||!this.targetInfo.article)&&t===this.targetInfo.article.authorId},deleteComment:function(t){t.preventDefault(),this.model.destroy()}});return r}.apply(e,i),!(void 0!==r&&(t.exports=r))},49:function(t,e,n){var i,r;i=[n(3)],r=function(_){var t=/(^|[\s\n,\.;\:!?\[\]{}()\u4e00-\u9fa5\u3002\uff1f\uff01\uff0c\u3001\uff1b\uff1a\u201c\u201d\u2018\u2019\uff08\uff09\u300a\u300b\u3008\u3009\u3010\u3011\u300e\u300f\u300c\u300d\ufe43\ufe44\u3014\u3015\u2026\u2014\uff5e\ufe4f\uffe5]|<[^a]+(?:\s*[\w-]*?=['"].+?['"])*>)((?:https?|ftp):\/\/[\-A-Z0-9+\u0026\u2019@#\/%?=()~_|!:,.;]*[\-A-Z0-9+\u0026@#\/%=~()_|])/gi;return function(e){var n=e.match(t);if(!n)return _.escape(e);for(var i=[],r=30,o=function(t,e,n){return n.length<r?e+'<span class="auto-linked"><a target="_blank" href="'+_.escape(n)+'">'+_.escape(n)+"</a></span>":e+'<span class="auto-linked"><a class="link-has-invisible" target="_blank" href="'+_.escape(n)+'">'+_.escape(n.substr(0,r))+'</a><span class="invisible-link">'+_.escape(n.substr(r))+"</span></span>"},a=0,s=n.length;a<s;a++){var c=n[a],u=e.indexOf(c);i.push(_.escape(e.substring(0,u))),i.push(c.replace(t,o)),e=e.substr(u+c.length)}return i.join("")+_.escape(e)}}.apply(e,i),!(void 0!==r&&(t.exports=r))},50:function(t,e,n){var i,r;i=[n(6),n(3),n(30),n(51)],r=function($,_,t,e){var n={stamp:"loginStamp"},i=t.hasWebStorage();return{openLoginAndSignup:function(t){t=t||{},_.isObject(t.actions)&&i&&_.each(t.actions,function(t,e){sessionStorage[n[e]]=JSON.stringify(t)}),e(t)},getActionOnce:function(t){if(i){var e=this.getAction(t);return sessionStorage.removeItem(n[t]),e}},getAction:function(t){if(i){var e=sessionStorage[n[t]];return e?JSON.parse(e):void 0}}}}.apply(e,i),!(void 0!==r&&(t.exports=r))},51:function(t,e,n){var i,r;i=[n(6),n(3)],r=function($,_){var t={context:"reader",closable:!0,referUrl:location.href},e=function(e){return e=_.defaults(e||{},t),function(t){document.cookie="refer_url="+e.referUrl+";domain=douban.com;path=/";new t(e)}},i=function(t){n.e(3,function(n){var i=[n(52)];e(t).apply(null,i)}.bind(this))};return i}.apply(e,i),!(void 0!==r&&(t.exports=r))},53:function(t,e,n){var i,r;i=[n(6),n(54),n(55)],r=function($,t,e){function n(n){e.call(this);var i=this;this.opts=n,this.el=$(r),this.text=this.el.find(".k-text"),this.head=this.el.find(".dialog-hd"),this.buttons=this.el.find(".k-buttons"),this.btnClose=this.el.find(".k-close"),this.closable=void 0===n.closable||!!n.closable,this.overlay=t({closable:this.closable}),this.render(),a.on("click.close-"+this.overlay.id,".k-close",function(){i.close()}),this.el.on("click.confirm","[data-confirm]",function(t){var e=!!$(t.currentTarget).data("confirm");i.emit(e?"confirm":"cancel"),e||i.close()}),this.overlay.on("close",function(){i.emit("close")})}function i(t){return t=t||{},new i.Dialog(t)}var r='<div id="ark-dialog"><div class="dialog-hd"><a href="javascript:;" class="k-close">&times;</a></div><div class="dialog-bd"><div class="k-text"></div><div class="k-buttons"></div></div></div>',o='<button class="btn btn-large" data-confirm="1">确定</button><button class="btn btn-minor btn-large" data-confirm="0">取消</button>',a=$(document);return $.extend(n.prototype,{render:function(){var t=this.opts.title,e=this.opts.foot;this.text.html(this.opts.content),this.closable||this.btnClose.remove(),t&&this.setTitle(t),e&&this.setFoot(e),this.setButtons(),this.overlay.setBody(this.el)},setTitle:function(t){return this.head.prepend($("<span>",{"class":"k-title",text:t})),this},setFoot:function(t){return this.el.append($("<div>",{"class":"dialog-ft",html:t})),this},setButtons:function(t){t=t||[];var e=this.opts.type,n=["确定","取消"],i=t.length;if(/confirm|tips/i.test(e)){this.buttons[0].innerHTML=o;for(var r=this.buttons.find("button"),a=0;a<i;a++)r.eq(a).text(t[a].text||n[a]).addClass(t[a]["class"]||"");"tips"===e&&$(r[1]).remove()}return"custom"===e&&(this.buttons[0].innerHTML=t),this},getBody:function(){return this.overlay.getContentElement()},setBody:function(t){return this.getBody().find(".k-text").html(t),this},addClass:function(t){return this.el.addClass(t),this},open:function(){return this.overlay.open(),this.emit("open"),this},close:function(t){return this.el.off(".confirm"),this.overlay.close(t),this}}),e(n.prototype),i.Dialog=n,i}.apply(e,i),!(void 0!==r&&(t.exports=r))},54:function(t,e,n){var i,r;i=[n(6),n(55)],r=function($,t){function e(){return"overlay-"+s++}function n(n){if(t.call(this),this.opts=n,this.el=$(r).appendTo("body"),this.body=this.el.find(".k-slave"),this.closable=void 0===n.closdable||!!n.closable,this.setBody(),this.el.addClass(n.klass),this.id=e(),this.closable){var i=this;o.on("click.close-"+this.id,"#ark-overlay",function(t){t.target===t.currentTarget&&i.close()}).on("keyup",function(t){var e=t.target.tagName,n=27===t.keyCode,r=/input|textarea/i.test(e);!r&&n&&i.close()})}}function i(t){return t=t||{},new i.Overlay(t)}var r='<div id="ark-overlay" class="hide"><div class="k-stick"></div><div class="k-content"><div class="k-slave"></div></div></div>',o=$(document),a=$("html"),s=0;return $.extend(n.prototype,{close:function(t){return this.el.remove(),a.removeClass("ark-overlay"),o.off(".close-"+this.id),t||this.emit("close"),this},getContentElement:function(){return this.el.find(".k-content")},open:function(){return this.scrollTop=o.scrollTop(),a.addClass("ark-overlay"),this.el.removeClass("hide"),this.emit("open"),this},setBody:function(t){return t=t||this.opts.body,this.body.html(t),this}}),t(n.prototype),i.Overlay=n,i}.apply(e,i),!(void 0!==r&&(t.exports=r))},55:function(t,e,n){var i,r;i=[n(13)],r=function(_){function t(e){if(e)return _.extend(e,t.prototype)}return t.prototype.on=t.prototype.bind=function(t,e){return 1===arguments.length?(_.each(t,function(t,e){this.on(e,t)},this),this):(this._callbacks=this._callbacks||{},(this._callbacks[t]=this._callbacks[t]||[]).push(e),this)},t.prototype.emit=t.prototype.trigger=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),n=this._callbacks[t];if(n){n=n.slice(0);for(var i=0,r=n.length;i<r;++i)n[i].apply(this,e)}return this},t}.apply(e,i),!(void 0!==r&&(t.exports=r))},56:function(t,e,n){var i,r;i=[n(3),n(6),n(57)],r=function(_,$,t){function e(e){e=_.defaults(e||{},n),_.extend(this,e),this.renderedTopics={},this.timeClassifier=new t({timeNames:this.topics}),this.renderTopicsList()}var n={el:$(),topicsTmpl:$("#tmpl-notification-topics").html(),topics:["today","week","month","older"]};return _.extend(e.prototype,{appendToTopic:function(t,e){var n=this.timeClassifier.getTimeName(e);return this.getTopicElem(n).find("ol").append(t),this},getTopicElem:function(t){if(t in this.renderedTopics)return this.renderedTopics[t];var e=this.el.children("."+t).show();return this.renderedTopics[t]=e,e},renderTopicsList:function(){this.el.html(_.template(this.topicsTmpl,{topics:this.topics}))},reset:function(){this.el.children().hide();return this.renderedTopics={},this}}),e}.apply(e,i),!(void 0!==r&&(t.exports=r))},57:function(t,e,n){var i,r;i=[n(3),n(6),n(58)],r=function(_,$,t){function e(t){t=_.defaults(t||{},r),_.extend(this,t),this.todayTime=this.getTodayTime(),this.timeStamps=this.getTimeStamps()}var n=864e5,i={today:0,yesterday:n,week:7*n,month:31*n,older:Number.POSITIVE_INFINITY},r={timeNames:["today","yesterday","week","month","older"]};return _.extend(e.prototype,{getTimeName:function(e){var n=t(e).valueOf(),i=this.todayTime-n,r=_.sortedIndex(this.timeStamps,i);return this.timeNames[r]},getTodayTime:function(){var t=new Date;return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.valueOf()},getTimeStamps:function(){return _.map(this.timeNames,function(t){return i[t]})}}),e}.apply(e,i),!(void 0!==r&&(t.exports=r))},58:function(t,e,n){var i;i=function(){return/msie 8/i.test(navigator.userAgent)?function(t){var e,n=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(([+-])([0-9]{2}):([0-9]{2}))?/,i=n.exec(t),r=function(t){return parseInt(t,10)};if(i){var o=Date.UTC(r(i[1]),r(i[2])-1,r(i[3]),r(i[4]),r(i[5]),i[6]&&r(i[6])||0);new Date;if(i[9]&&i[10]){var a=60*r(i[9])+r(i[10]),s="+"===i[8]?-1:1;o+=s*a*6e4}e=new Date(o)}return e}:function(t){return new Date(t)}}.call(e,n,e,t),!(void 0!==i&&(t.exports=i))},59:function(t,e,n){var i,r;i=[n(2),n(3),n(6),n(21),n(22),n(60),n(61),n(66),n(68)],r=function(t,_,$,e,n,i,r,o,a){var s=t.View.extend({el:"#ark-reader",tmplHeader:$("#tmpl-column-header").html(),tmplFooter:$("#tmpl-column-footer").html(),initialize:function(){this.vent=n.vent,this.vent.on("paging:finish",this.renderFrame,this),this.vent.on("pages:layout:finish",this.adjustCanvasHeight,this),this.$el.addClass("lite-theme")},events:{"click .btn-purchase":"buy"},getChapterTitle:function(t){return this.chaptersIdList=this.chaptersIdList||[],this.chaptersIdList.length||(this.chaptersIdList=_.map(this.chaptersList,function(t){return t.id})),this.chaptersMap[this.chaptersIdList[_.indexOf(this.chaptersIdList,this.currentChapterId)+t]]},adjustCanvasHeight:function(){var t=n.articleInner.height(),e=this.$el.find(".page:last");e.height("auto").find(".bd").height("auto");var i=e.height(),r=768-i,o=t-r,a=7.5;e.height("48em").find(".bd").height("48em"),n.articleInner.height(o/16+a+"em")},renderFrame:function(){this.chapterOverlayClone=this.$el.find(".article .chapter-overlay").clone(!0),this.chaptersMap=this.chaptersMap||{},this.currentChapterId=n.getModel("article").id,_.each(this.chaptersList,_.bind(function(t){this.chaptersMap[t.get("id")]=t.get("title")},this)),_.extend(this.modelData,{chapter_id:this.currentChapterId});var t=this.$el.find(".lite-header");t.length||this.renderHeader(),this.chapterOverlayClone.find(".chapter-prev").text(this.getChapterTitle(-1)).end().find(".chapter-next").text(this.getChapterTitle(1)),this.$el.find(".lite-footer .inner").html(this.chapterOverlayClone),delete this.chapterOverlayClone},renderHeader:function(){var t=_.pick(this.modelData,"agent","title","id","price");_.extend(t,{isSample:this.modelData.is_sample,hasAdded:this.modelData.is_paid,isAnonymous:e.me.isAnonymous,canSale:this.modelData.can_sale}),this.$el.prepend(_.template(this.tmplHeader,t)).append(_.template(this.tmplFooter));var n=this.$el.find(".lite-header");if(this.renderSubscribeButton(this.$(".btn-subscribe"),this.model),this.modelData.is_sample&&this.appendPurchaseButton(this.model),!this.modelData.is_paid&&0===+this.modelData.price){var i=this.model;a.apply({aid:this.modelData.identity,title:this.modelData.title,wrapper:n,placeholderSel:".btn-adding-wrapper",success:function(){i.set("is_paid",!0)}}).render(),n.find(".lnk-collect").addClass("head-controls-item").attr("data-helper",function(){return $(this).text()})}},render:function(t){this.model=t.model,this.$el.find(".aside-controls").show(),this.modelData=this.model.toJSON(),this.chaptersList=this.chaptersList||this.modelData.chapters},buy:function(t){t.preventDefault(),e.me.isAnonymous||this.purchaseWidget.doPurchase()},appendPurchaseButton:function(t){var e=o(t,{isLightBtn:!0});e.$(".btn").addBack(".btn").addClass("btn-column btn-purchase head-controls-item").attr("data-helper",e.$(".btn").text()),this.$el.find(".btn-purchase-wrapper").html(e.el),this.purchaseWidget=new r(e.$el)},renderSubscribeButton:function(t,r){function o(e){var n=e?"取消订阅":"订阅";t.removeClass("is-loading").toggleClass("is-subscribed",e).attr("data-helper",n).attr("title",n)}return r.get("has_finished")?void t.hide():(o(r.get("is_subscribed")),t.on("click",function(){e.me.isAnonymous?n.trigger("open:login-dialog"):(r.toggleSubscribe(),t.addClass("is-loading"))}),void r.on("change:is_subscribed",function(t,e){o(e),i.toast(e?"已订阅":"已取消")}))}});return s}.apply(e,i),!(void 0!==r&&(t.exports=r))},60:function(t,e,n){var i,r;i=[n(6),n(3)],r=function($,_){var t=$(window),e=$("body"),n=function(e){this.options=_.defaults(e||{},this.defaults);var n=_.result(this,"el");n.html(e.text);var i=n.outerWidth(),r=(t.width()-i)/2;if(n.css({left:r}),"middle"===e["vertical-align"]){var o=(t.height()-n.outerHeight())/2;n.css({top:o})}_.delay(function(){n.fadeOut(function(){n.remove()})},e.delay)};_.extend(n.prototype,{defaults:{delay:1e3,id:"toast-container",text:"加载中"},el:function(){var t=this.options,n=t.id,i=$("#"+n);return i.length?i.stop(!0).css({opacity:i.data("orig-opacity")||1}):(i=$("<div>",{id:n}).appendTo(e),i.data("orig-opacity",i.css("opacity"))),i}});var i={toast:{"vertical-align":"middle",delay:900}};return _.each(["alert","toast"],function(t){n[t]=function(e){return new n(_.extend({id:"reminder-"+t,text:e},i[t]))}}),n}.apply(e,i),!(void 0!==r&&(t.exports=r))},61:function(t,e,n){var i,r;i=[n(6),n(62),n(9),n(10),n(12),n(53),n(63),n(64)],r=function($,t,e,n,i,r,o,a){var s="http://help.douban.com/help/ask?category=book&type=43",c=function(t){this._el=t,this.tmplPurchaseDialog=$("#tmpl-purchase-dialog").html(),this.tmplPurchaseSuccess=$("#tmpl-purchase-success").html()};$.extend(c.prototype,a,{doPurchase:function(){this.checkBalance()},onReadyToBuy:function(t,e,a,s){if(this.isFree())return void this.buyAsFree();var c=this,u=this._readablePrice(s.amount),l=this._readablePrice(s.rest),h=this._readablePrice(s.balance),d=this.getUsername(),f="购买"+this.getKindName(),p=this.isPrivate(),m=r({type:"confirm",title:f,content:i(this.tmplPurchaseDialog,{title:this.getTitle(),extra_title:this.getExtraTitle(),price:u,amount:l,balance:h,consumptions:s.bill,username:d,secretly:p,subscribed:this.isSubscribed(),isChapter:this.isChapter(),moneyformat:function(t){return t.toFixed(2)}})}).on("confirm",function(){var t=this.getBody(),e=t.find("[name=secretly]");c.addSubscription=t.find("[name=add_subscription]").is(":checked")?"on":"",e.prop("checked")?(c.secretly=e.val(),n("pp",1,{"max-age":31536e4})):(c.secretly="",n.remove("pp")),c.getBought(l),this.close(!0)}).addClass("purchase-dialog").on("close",function(){c._el.trigger("purchase:failed"),c.cancel()}).open();o.init({el:m.el.find(".payment-channels")}),this.paymentForm=o.form},onBought:function(){this.isFree()?location.reload():this.showSuccessDialog()},onCheckingBalance:function(){return this.isFree()?void this.passedCheck():(this.trackPurchaseEvent("tryToBuy"),void this._checkBalance())},ongetBought:function(t,e,n,i){i?this._confirmThirdPartyToBuy(i):this._confirmToBuy()},onbuyAsFree:function(){this._confirmToBuy()},showSuccessDialog:function(){var t,e=this,n=this.tmplPurchaseSuccess,o=3,a=this.isCartPurchase(),s=i(n,{sec:o,isCartPurchase:a});t=a?r({type:"tips",title:"购买成功",content:s}).setButtons([{text:"知道了"}]):r({type:"confirm",title:"购买成功",content:s}).setButtons([{text:"去阅读"},{text:"知道了"}]),t.addClass("purchase-success-dialog").on("close",function(){clearInterval(u),e._el.trigger("purchase:finish",e.getRedirectUrl())}).on("confirm",function(){location.href=e.getReaderUrl()}).on("cancel",function(){this.close()}).open();var c=t.el.find(".count-down-num")[0];c.innerHTML=o;var u=setInterval(function(){o-=1,c.innerHTML=o,o||(clearInterval(u),t.close())},1e3)},onsucceededToBuy:function(t,e,n,i){this.isFree()?this.trackPurchaseEvent("got"):(this.trackPurchaseEvent("bought"),this.trackEcommerce(i.order,this.getOrigin(),"购买")),this._el.trigger("purchase:success")},onfailedToBuy:function(){this.trackPurchaseEvent("failed"),this._el.trigger("purchase:failed")},_readablePrice:function(t){return t/100},_readableAmount:function(t){return t<0?Math.abs(t)/100:0},_checkBalance:function(){var t=this;this._el.trigger("checkBalance:start"),e.get("/j/bill?works_ids="+this.getWorksIds().join(",")).done(function(e){t.passedCheck(e)}).fail(function(){t._el.trigger("checkBalance:failed"),t.trackPurchaseEvent("checkBalanceFailed"),r({type:"confirm",title:"出错了",content:"无法获取账户余额，也许是网络连接出现了问题。"}).setButtons([{text:"重试"},{text:"问题反馈"}]).on("confirm",function(){this.close(!0),t._checkBalance()}).on("cancel",function(){window.open(s)}).on("close",function(){t.failedCheck()}).open()})},_confirmThirdPartyToBuy:function(t){var e=this,n=r({type:"confirm",title:"等待支付",content:"请在新打开的页面中完成支付。",closable:!1}).addClass("general-tips").setButtons([{text:"支付成功"},{text:"遇到问题"}]).on("confirm",function(){location.reload()}).on("cancel",function(){e._el.trigger("bought:failed"),e.failedToBuy(),window.open(s)});n.open(),this._requestThirdPartyToBuy(t)},_requestThirdPartyToBuy:function(t){var e=[{name:"amount",value:t},{name:"secretly",value:this.secretly},{name:"add_subscription",value:this.addSubscription}];e.push.apply(e,$.map(this.getWorksIds(),function(t){return{name:"works_ids",value:t}}));for(var n=e.length;n;)this.paymentForm.append($("<input>",{type:"hidden"}).attr(e[--n]));this.paymentForm.submit()},_requestToBuy:function(){var t=this.isFree()?"获取作品":"确认购买",n="正在{{EVENT}}，请稍候...".replace("{{EVENT}}",t),i=r({type:"tips",title:t,content:n}).addClass("general-tips").open(),o=$.param({works_ids:this.getWorksIds(),secretly:this.secretly||"",add_subscription:this.addSubscription},!0);return e({type:"POST",url:"/j/article/buy",dataType:"json",arkWithDocReferer:!0,data:o}).always(function(){i.close()})},_confirmToBuy:function(){var t=this;t._requestToBuy().done(function(e){!e||e.r?t._confirmToBuyFailed(e?e.err:"出现了奇怪的错误:("):t.succeededToBuy(e)}).fail(function(){t._confirmToBuyFailed("无法完成购买操作，也许是网络连接出现了问题。")})},_confirmToBuyFailed:function(t){var e=this;this.trackPurchaseEvent("finalPurchaseFailed"),r({type:"confirm",title:"出错了",content:t}).setButtons([{text:"重试"},{text:"问题反馈"}]).on("confirm",function(){this.close(!0),e._confirmToBuy()}).on("cancel",function(){window.open(s)}).on("close",function(){e.failedToBuy()}).addClass("general-tips").open()},isFree:function(){return!this.getPriceInCents()},isPrivate:function(){return!!n("pp")},isSubscribed:function(){return!!this._el.data("subscribed")},isChapter:function(){return this._el.data("is-chapter")},getPrice:function(){return this._el.data("readable-price")},getPriceInCents:function(){return this._el.data("price")},getTitle:function(){return this._el.data("title")},getExtraTitle:function(){return this._el.data("extra-title")},getKindName:function(){return this._el.data("kind-name")},getWorksIds:function(){return(this._el.data("works-ids")+"").split(",")},isCartPurchase:function(){return!!this._el.data("is-cart")},getArticleUrl:function(){return this._el.data("url")},getReaderUrl:function(){return this._el.data("reader-url")},getRedirectUrl:function(){return this._el.data("redirect-url")},getUsername:function(){return this._el.data("username")},getOrigin:function(){var t=/^\/(reader|\w*)/gi.exec(location.pathname)[1],e="reader"===t?t:"new-store";return e},isLargeBtn:function(){return this.isLargeBtn=this._el.data("is-large-btn"),
this.isLargeBtn}});t.create({target:c.prototype,events:[{name:"checkBalance",from:"none",to:"CheckingBalance"},{name:"passedCheck",from:"CheckingBalance",to:"ReadyToBuy"},{name:"failedCheck",from:"CheckingBalance",to:"none"},{name:"getBought",from:"ReadyToBuy",to:"Buying"},{name:"succeededToBuy",from:"Buying",to:"Bought"},{name:"cancel",from:"ReadyToBuy",to:"none"},{name:"failedToBuy",from:"Buying",to:"none"},{name:"buyAsFree",from:"ReadyToBuy",to:"Buying"}]});return c.applyWithIn=function(t,e){$(e).find(t).each(function(t,e){new c($(e))})},c}.apply(e,i),!(void 0!==r&&(t.exports=r))},62:function(t,e,n){!function(){var n={VERSION:"2.3.5",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(t,e){var i="string"==typeof t.initial?{state:t.initial}:t.initial,r=t.terminal||t["final"],o=e||t.target||{},a=t.events||[],s=t.callbacks||{},c={},u={},l=function(t){var e=t.from instanceof Array?t.from:t.from?[t.from]:[n.WILDCARD];c[t.name]=c[t.name]||{};for(var i=0;i<e.length;i++)u[e[i]]=u[e[i]]||[],u[e[i]].push(t.name),c[t.name][e[i]]=t.to||e[i]};i&&(i.event=i.event||"startup",l({name:i.event,from:"none",to:i.state}));for(var h=0;h<a.length;h++)l(a[h]);for(var d in c)c.hasOwnProperty(d)&&(o[d]=n.buildEvent(d,c[d]));for(var d in s)s.hasOwnProperty(d)&&(o[d]=s[d]);return o.current="none",o.is=function(t){return t instanceof Array?t.indexOf(this.current)>=0:this.current===t},o.can=function(t){return!this.transition&&(c[t].hasOwnProperty(this.current)||c[t].hasOwnProperty(n.WILDCARD))},o.cannot=function(t){return!this.can(t)},o.transitions=function(){return u[this.current]},o.isFinished=function(){return this.is(r)},o.error=t.error||function(t,e,n,i,r,o,a){throw a||o},i&&!i.defer&&o[i.event](),o},doCallback:function(t,e,i,r,o,a){if(e)try{return e.apply(t,[i,r,o].concat(a))}catch(s){return t.error(i,r,o,a,n.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",s)}},beforeAnyEvent:function(t,e,i,r,o){return n.doCallback(t,t.onbeforeevent,e,i,r,o)},afterAnyEvent:function(t,e,i,r,o){return n.doCallback(t,t.onafterevent||t.onevent,e,i,r,o)},leaveAnyState:function(t,e,i,r,o){return n.doCallback(t,t.onleavestate,e,i,r,o)},enterAnyState:function(t,e,i,r,o){return n.doCallback(t,t.onenterstate||t.onstate,e,i,r,o)},changeState:function(t,e,i,r,o){return n.doCallback(t,t.onchangestate,e,i,r,o)},beforeThisEvent:function(t,e,i,r,o){return n.doCallback(t,t["onbefore"+e],e,i,r,o)},afterThisEvent:function(t,e,i,r,o){return n.doCallback(t,t["onafter"+e]||t["on"+e],e,i,r,o)},leaveThisState:function(t,e,i,r,o){return n.doCallback(t,t["onleave"+i],e,i,r,o)},enterThisState:function(t,e,i,r,o){return n.doCallback(t,t["onenter"+r]||t["on"+r],e,i,r,o)},beforeEvent:function(t,e,i,r,o){if(!1===n.beforeThisEvent(t,e,i,r,o)||!1===n.beforeAnyEvent(t,e,i,r,o))return!1},afterEvent:function(t,e,i,r,o){n.afterThisEvent(t,e,i,r,o),n.afterAnyEvent(t,e,i,r,o)},leaveState:function(t,e,i,r,o){var a=n.leaveThisState(t,e,i,r,o),s=n.leaveAnyState(t,e,i,r,o);return!1!==a&&!1!==s&&(n.ASYNC===a||n.ASYNC===s?n.ASYNC:void 0)},enterState:function(t,e,i,r,o){n.enterThisState(t,e,i,r,o),n.enterAnyState(t,e,i,r,o)},buildEvent:function(t,e){return function(){var i=this.current,r=e[i]||e[n.WILDCARD]||i,o=Array.prototype.slice.call(arguments);if(this.transition)return this.error(t,i,r,o,n.Error.PENDING_TRANSITION,"event "+t+" inappropriate because previous transition did not complete");if(this.cannot(t))return this.error(t,i,r,o,n.Error.INVALID_TRANSITION,"event "+t+" inappropriate in current state "+this.current);if(!1===n.beforeEvent(this,t,i,r,o))return n.Result.CANCELLED;if(i===r)return n.afterEvent(this,t,i,r,o),n.Result.NOTRANSITION;var a=this;this.transition=function(){return a.transition=null,a.current=r,n.enterState(a,t,i,r,o),n.changeState(a,t,i,r,o),n.afterEvent(a,t,i,r,o),n.Result.SUCCEEDED},this.transition.cancel=function(){a.transition=null,n.afterEvent(a,t,i,r,o)};var s=n.leaveState(this,t,i,r,o);return!1===s?(this.transition=null,n.Result.CANCELLED):n.ASYNC===s?n.Result.PENDING:this.transition?this.transition():void 0}}};"undefined"!=typeof t&&t.exports&&(e=t.exports=n),e.StateMachine=n}()},63:function(t,e,n){var i,r;i=[n(6),n(9),n(12)],r=function($,t,e){var n={init:function(t){return this.el=t.el,this.render(),this},template:$("#tmpl-payment-channels").html(),render:function(){return this.el.find(".content").html(e(this.template)),this.form=this.el.find(".payment-form"),this}};return n}.apply(e,i),!(void 0!==r&&(t.exports=r))},64:function(t,e,n){var i,r;i=[n(65)],r=function(t){var e={trackPurchaseEvent:function(e){var n=this.isChapter()?"column-purchase":"purchase";t.trackEvent(n,e,this.getTitle(),this.getPriceInCents())},trackEcommerce:function(e,n,i){var r=this.getPrice();t.trackEcommerce({id:e,affiliation:n,revenue:r},{id:e,sku:this.getWorksIds()[0],name:this.getTitle(),category:i||"",price:r,quantity:1})}};return e}.apply(e,i),!(void 0!==r&&(t.exports=r))},65:function(t,e,n){var i,r;i=[],r=function(){var t={},e=Array.prototype.slice;return t.trackPageview=function(t){ga("send","pageview",t.replace(/^(\/*)/g,"/"))},t.trackEvent=function(t,n){var i=e.call(arguments,2),r=["send","event",t,n];if(i.length>0){var o=0,a=1;"number"==typeof i[o]&&(i[o]=i[o].toString()),"string"==typeof i[a]&&(i[a]=+i[a]),r=r.concat(i)}ga.apply(this,r)},t.trackEcommerce=function(t,e){ga("ecommerce:addTransaction",t),ga("ecommerce:addItem",e),ga("ecommerce:send")},t.delayRun=function(t){var e=function(){setTimeout(t,400)};e()},t}.apply(e,i),!(void 0!==r&&(t.exports=r))},66:function(t,e,n){var i,r;i=[n(21),n(3),n(32),n(67)],r=function(t,_,e,n){function i(t,e){return t*(/ebook|gallery/.test(e)?100:1)}function r(r,a){var s=new n,c=r.toJSON(),u=r.get("type")||o[t.works.type],l=i(+r.get("price"),u),h=i(+r.get("fixedPrice"),u),d="column"===u,f=r.get("is_subscribed"),p=r.get("has_finished"),m=d?"chapter/"+c.chapters[0].id+"/":"",g=["",d?u:"ebook",r.get("id"),m].join("/"),v="/reader"+g,y=_.extend(c,{url:g,redirect_url:v,price:l,fixedPrice:h,is_large_btn:!0,is_hollow_btn:!1,is_subscribed:p||f,is_mobile_direct_purchase:e.fitForMobile,type:u},a||{});return d&&(y.id=c.identity),s.render({data:y})}var o={t:"ebook",g:"gallery"};return r}.apply(e,i),!(void 0!==r&&(t.exports=r))},67:function(t,e,n){var i,r;i=[n(2),n(3),n(6),n(10),n(21)],r=function(t,_,$,e,n){function i(t){return(t/100).toFixed(2)}var r={ebook:"图书",gallery:"画册",chapter:"篇目"},o=t.View.extend({mobileTmpl:$("#tmpl-mobile-purchase-button").html(),btnWrapperTmpl:$("#tmpl-purchase-button-wrapper").html(),btnInnerTmpl:$("#tmpl-purchase-button-inner").html(),className:"action-button",render:function(t){var e=t.data,o=n.me.isAnonymous,a="column"===e.type?"整部"+e.kind:r[e.type];return _.defaults(e,{kind_name:a,widget:e.asGift?"purchase-as-gift":"faster-purchase",readable_price:i(e.price),readable_fixed_price:i(e.fixedPrice),username:n.me.name,isAnonymous:o,is_mobile_direct_purchase:!1,isLightBtn:!1}),e.is_mobile_direct_purchase?this.renderModileButton(e):this.renderDesktopButton(e),this},renderModileButton:function(t){var n,i=e("page_style");n=i&&"web"===i?"/account/?about_to_buy={{- id}}":"/purchase/?about_to_buy={{- id}}",t.mobile_direct_purchase_url=_.template(n,t),this.setElement(_.template(this.mobileTmpl,t))},renderDesktopButton:function(t){var e=_.template(this.btnInnerTmpl,t);t.isAnonymous?this.$el.html(e):(this.setElement(_.template(this.btnWrapperTmpl,t)),this.$el.append(e))}});return o}.apply(e,i),!(void 0!==r&&(t.exports=r))},68:function(t,e,n){var i,r;i=[n(3),n(6),n(21),n(22),n(9),n(30),n(32),n(53),n(60)],r=function(_,$,t,e,n,i,r,o,a){function s(e){_.bindAll(this,"addToBookshelf","handleAddToBookshelf"),this.aid=e.aid,this.title=e.title,this.wrapper=e.wrapper,this.placeholderSel=e.placeholderSel,this.isAnonymous=t.me.isAnonymous,this.success=e.success,this.wrapper.on("click",h,this.handleAddToBookshelf)}var c=$("#tmpl-added-status").html(),u=$("#tmpl-add-to-bookshelf").html(),l="/j/receive/",h=".lnk-collect",d=$("#tmpl-add-to-bookshelf-confirm").html();return _.extend(s.prototype,{render:function(){this.wrapper.find(this.placeholderSel).html(_.template(u,{isAnonymous:t.me.isAnonymous,loginUrl:t.DOUBAN+"/accounts/login?redir="+location.href,fitForMobile:r.fitForMobile,isWeixin:i.isWeixin()}))},handleAddToBookshelf:function(e){var n=this;o({title:"领取"+this.getKindName(),content:_.template(d,{title:this.title,username:t.me.name}),type:"confirm"}).addClass("purchase-dialog").open().on("confirm",function(){var t=this.text.find("[name=secretly]").is(":checked");n.addToBookshelf(n.aid,t),this.close()})},addToBookshelf:function(t,e){if(!this.isAnonymous){var i=this.wrapper.find(h),r=(i.text(),_.now()),o=this;a.toast("领取中..."),n.post(l,{works_id:t,is_secretly:0|e}).done(function(t){var e=t.err;e?a.toast(e):_.delay(function(){var t=i.closest(".btn-adding-wrapper"),e=$(c).hide();a.toast("领取成功"),t.replaceWith(e),e.fadeIn(300),o.success&&o.success()},600-(_.now()-r))}).fail(function(){a.toast("出现了奇怪的错误，请稍后再试")})}},getKindName:function(){return t.works.isChapter?e.getModel("column").get("kind"):"图书"}}),s.apply=function(t){return new s(t)},s}.apply(e,i),!(void 0!==r&&(t.exports=r))},69:function(t,e,n){var i,r;i=[n(6),n(2),n(3),n(21),n(22),n(70),n(71),n(60),n(9),n(73)],r=function($,t,_,e,n,i,r,o,a,s){function c(t){u[t.get("id")]=t}var u={},l=t.View.extend({initialize:function(t){this.modelDfd=$.Deferred(),this.modelPromise=this.modelDfd.promise(),this.initChapters(t.columnId,t.chapterId)},render:function(t){return this.canvas=t.canvas,this.resetAdapter(),this.adaptCanvas(),this},initChapters:function(t,e){this.chaptersCollection=new r([],{columnId:t,currChapterId:e}),n.setModel("chapters",this.chaptersCollection),this.columnModel=new i({id:t}),n.setModel("column",this.columnModel),this.columnModel.on("change:chapters",function(t,e){this.chaptersCollection.reset(e),this._markCurrChapterAsRead(),this.modelDfd.resolve()},this),t in u?this.columnModel.set(u[t].toJSON()):this.columnModel.fetch(),c(this.columnModel),n.vent.on("turningPrev:firstPage",this.turnPrevChapter,this).on("turningNext:lastPage",this.turnNextChapter,this).on("chapterTurn:adjacent",this.adjacentTurnPrompt,this).on("reader:layout:finish",this.checkToShowGift,this).on("show:giftOverlay",this.showGift,this);var o=this.chaptersCollection.currChapter;this.listenTo(o,"change:chapterId",function(e,i){var r=["column",t,"chapter",i,""].join("/");n.router.navigate(r,{trigger:!0})}),this.pipeEvents(o,["change:isFirstChapter","change:isLastChapter"])},pipeEvents:function(t,e){var n=this;return _.each(e,function(e){n.listenTo(t,e,_.bind(n.trigger,n,e))}),this},_markCurrChapterAsRead:function(){var t=this.chaptersCollection,e=t.getCurrChapter();e&&e.set("is_read",!0),this.columnModel.set("chapters",t.models)},cleanChapters:function(){this.chaptersCollection.destroy(),n.unsetModel("chapters"),n.unsetModel("column")},adaptCanvas:function(){this.initChapterOverlay(),this.bindChapterPosClass(this.canvas.$el)},resetAdapter:function(){var t=this.canvas.$el.find(".chapter-overlay");t.off(".chapter-adapter")},initChapterOverlay:function(){var t=this.canvas.$el.find(".chapter-overlay");t.on("click.chapter-adapter",".chapter-switcher",_.bind(function(t){var e=$(t.currentTarget),n=e.data("direction");this["prev"===n?"turnPrevChapter":"turnNextChapter"]()},this))},bindChapterPosClass:function(t){this.on("change:isFirstChapter",function(e,n){t.toggleClass("first-chapter",n)}).on("change:isLastChapter",function(e,n){t.toggleClass("last-chapter",n)});var e=this.chaptersCollection.currChapter;t.toggleClass("first-chapter",e.get("isFirstChapter")).toggleClass("last-chapter",e.get("isLastChapter"))},turnPrevChapter:function(){return this.chaptersCollection.currChapter.get("isFirstChapter")?void o.toast("没有上一篇了"):(n.getModel("config").set("jumpLastPage",!0),void this.chaptersCollection.turnPrevChapter())},turnNextChapter:function(){return this.chaptersCollection.currChapter.get("isLastChapter")?void o.toast("没有下一篇了"):(n.getModel("config").set("jumpFirstPage",!0),void this.chaptersCollection.turnNextChapter())},checkToShowGift:function(){var t=this.columnModel.get("gift");t&&!t.opened&&(t.opened=!0,this.showGift())},showGift:function(){var t=this.columnModel.get("gift");t&&(this.giftOverlay=new s({gift:t}),this.giftOverlay.open())},remove:function(){this.resetAdapter(),this.cleanChapters(),n.vent.off("turningPrev:firstPage"),n.vent.off("turningNext:lastPage"),n.vent.off("chapterTurn:adjacent"),t.View.prototype.remove.apply(this,arguments)},labelsMap:{prev:"上一篇",next:"下一篇"},jumpingTmpl:"<span>{{- label}}</span><div>{{= title}}</div>",adjacentTurnPrompt:function(t){if(n.hasModel("article")){var e=n.getModel("article"),i={title:e.get("title"),label:this.labelsMap[t.direction]};o.toast(_.template(this.jumpingTmpl,i))}}});return l}.apply(e,i),!(void 0!==r&&(t.exports=r))},70:function(t,e,n){var i,r;i=[n(2),n(3),n(9)],r=function(t,_,e){var n=t.Model.extend({defaults:{id:0,is_subscribed:!1},url:function(){return"/j/column/"+this.get("id")+"/"},subscribeUrl:function(){return"/j/column/"+this.get("id")+"/subscription"},urlInMobileStore:function(){return"/column/"+this.get("id")},subscribe:function(){return this.toggleSubscribe(!0)},toggleSubscribe:function(t){return _.isUndefined(t)&&(t=!this.get("is_subscribed")),e({method:t?"put":"delete",url:_.result(this,"subscribeUrl")}).done(_.bind(function(e){this.set("is_subscribed",t)},this))}});return n}.apply(e,i),!(void 0!==r&&(t.exports=r))},71:function(t,e,n){var i,r;i=[n(2),n(3),n(72)],r=function(t,_,e){var n=t.Model.extend({defaults:{chapterId:0,isFirstChapter:!1,isLastChapter:!1},setPositionFlag:function(t,e){return this.set("isFirstChapter",t<=0),this.set("isLastChapter",t===e-1),this}}),i=t.Collection.extend({model:e,initialize:function(t,e){_.bindAll(this,"turnPrevChapter","turnNextChapter"),this.columnId=e.columnId,this.currChapter=new n({chapterId:e.currChapterId}),this.on("reset",function(){var t=this.getCurrIndex();this.currChapter.setPositionFlag(t,this.length)})},getCurrChapter:function(){return this.get(this.currChapter.get("chapterId"))},getCurrIndex:function(){return this.indexOf(this.getCurrChapter())},turnNextChapter:function(){var t=this.getCurrIndex();return this.turnByIndex(t+1)},turnPrevChapter:function(){var t=this.getCurrIndex();return this.turnByIndex(t-1)},turnByIndex:function(t){return t>=0&&t<this.length&&(this.turnById(this.at(t).id),this.currChapter.setPositionFlag(t,this.length)),this},turnById:function(t){return this.get(t)&&this.currChapter.set("chapterId",t),this},destroy:function(){this.currChapter.off(),this.off()},currChapterNeedBuy:function(){var t=this.getCurrChapter();return t&&t.needBuy()}});return i}.apply(e,i),!(void 0!==r&&(t.exports=r))},72:function(t,e,n){var i,r;i=[n(2),n(3)],r=function(t,_){return t.Model.extend({needBuy:function(){return!this.get("is_free")&&!this.get("is_allowed_to_read")}})}.apply(e,i),!(void 0!==r&&(t.exports=r))},73:function(t,e,n){var i,r;i=[n(3),n(6),n(21),n(54)],r=function(_,$,t,e){function n(t){this.gift=t.gift}var i=$("#tmpl-gift-inner").html();return _.extend(n.prototype,{open:function(){var n=this.gift,r=e({closeable:!0,klass:"full-height-overlay gift-overlay-wrapper",body:_.template(i,{page:{note:{recipient:t.me.name,words:n.words,sender:n.sender,date:n.date}}})});r.body.on("click",".close",function(){r.close()}),r.open(),this.overlay=r},close:function(){this.overlay&&(this.overlay.close(),delete this.overlay)}}),n}.apply(e,i),!(void 0!==r&&(t.exports=r))},193:function(t,e,n){var i,r;i=[n(6),n(3),n(21),n(35)],r=function($,_,t,e){var n=/^e\d+/,i=5,r="v1.1.0",o={freeUpStorageSpace:function(){for(var t=this.getArticleKeys(),n=t.length;n>=i;)n-=1,e.remove(t.pop())},checkStorageVersion:function(){var e=this.hasStorageData();if(!e)return this.saveReaderDataVersion(),!0;var n=this.getReaderDataVersion();return n===t.READER_DATA_VERSION||(this.resetReaderData(),!1)},resetReaderData:function(){this.emptyArticles(),this.saveReaderDataVersion()},saveReaderDataVersion:function(){e.set("readerDataVersion",t.READER_DATA_VERSION)},hasStorageData:function a(){var a=e.get("hasStorageData");return a=!!a||!!e.get("layout"),e.set("hasStorageData",!0),a},getReaderDataVersion:function(){return e.get("readerDataVersion")||r},getArticle:function(t){var n=e.get("e"+t);if(n)return n=n.split(":"),{title:n[0],data:n[1],purchase_time:0|n[2],is_sample:!!(0|n[3]),is_gift:!!(0|n[4]),has_formula:!!(0|n[5]),has_added:!!(0|n[6]),price:+n[7],lang:n[8],cover_url:decodeURIComponent(n[9]),fixed_price:+n[10]}},saveArticle:function(t,n){var i=encodeURIComponent(n.cover_url.split("?")[0]),r=[0|n.purchase_time,0|n.is_sample,0|n.is_gift,0|n.has_formula,0|n.has_added,+n.price,n.lang,i,+n.fixed_price].join(":");e.set("e"+t,[n.title,n.data,r].join(":"))},emptyArticles:function(){var t=this.getArticleKeys();_.each(t,function(t){e.remove(t)})},getArticleKeys:function(){var t=e.keys(),i=_.filter(t,function(t){return n.test(t)});return i},setArticleAttr:function(t,e,n){var i=this.getArticle(t);i&&(i[e]=n,this.saveArticle(t,i))},resetForDifferentUser:function(t){t=t||"anonymous";var n=e.get("readerUserId");n!==t&&this.resetReaderData(),e.set("readerUserId",t)}};return o}.apply(e,i),!(void 0!==r&&(t.exports=r))},323:function(t,e,n){var i,r;(function($){"use strict";i=[n(2),n(9)],r=function(t,e){return t.Model.extend({defaults:{name:"匿名用户"},url:function(){return"/j/user/"+this.get("id")+"/"},initialize:function(){this.on("sync",function(){this._loaded=!0},this),this.on("request",function(t,e,n){if(!t.get("id"))return $.Deferred().reject()})},isLoaded:function(){return!!this._loaded&&this.has("avatar")},isAdmin:function(){return!!this.get("isAdmin")},isAnonymous:function(){return!!this.get("isAnonymous")},isAuthorOf:function(t){var e=t.get("authorId"),n=this.get("id");return e&&e.toString()===n.toString()},canRate:function(t){return!(this.isAnonymous()||t.get("isSample"))}})}.apply(e,i),!(void 0!==r&&(t.exports=r))}).call(e,n(6))}});
